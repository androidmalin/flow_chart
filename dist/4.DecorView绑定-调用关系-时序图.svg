<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1852px" preserveAspectRatio="none" style="width:2005px;height:1852px;" version="1.1" viewBox="0 0 2005 1852" width="2005px" zoomAndPan="magnify"><defs><filter height="300%" id="f1q64d7xlx6ts4" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="200" x="902" y="28.6855">DecorView绑定-调用关系</text><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="1228.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="127" y="399.4688"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="873.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="132" y="753.6875"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="137" y="797.0391"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="93.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="441" y="434.8203"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="143.582" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="441" y="558.5781"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="441" y="1592.1797"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="100.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661" y="602.1055"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="666" y="653.6328"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="40.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="951.5" y="903.2695"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="613.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1105.5" y="943.7969"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="186.1094" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="990.5"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="344.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="1211.9609"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="78.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1404.5" y="1250.3125"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1409.5" y="1293.6641"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="91.8789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="1670.8828"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1404.5" y="1714.2344"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="132" x2="132" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="446" x2="446" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="666" x2="666" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="841.5" x2="841.5" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="956.5" x2="956.5" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1110.5" x2="1110.5" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1404.5" x2="1404.5" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1762" x2="1762" y1="89.25" y2="1793.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1878" x2="1878" y1="89.25" y2="1793.9375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="84" y="86.1738">ActivityThread</text><ellipse cx="132" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="120" x2="144" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="84" y="1807.4707">ActivityThread</text><ellipse cx="132" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="120" x2="144" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="421" y="86.1738">Activity</text><ellipse cx="446" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="434" x2="458" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="421" y="1807.4707">Activity</text><ellipse cx="446" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="434" x2="458" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="618" y="86.1738">PhoneWindow</text><ellipse cx="666" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="654" x2="678" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="618" y="1807.4707">PhoneWindow</text><ellipse cx="666" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="654" x2="678" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="805.5" y="86.1738">DecorView</text><ellipse cx="842" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="830" x2="854" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="805.5" y="1807.4707">DecorView</text><ellipse cx="842" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="830" x2="854" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="888.5" y="86.1738">WindowManagerImpl</text><ellipse cx="956.5" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="944.5" x2="968.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="888.5" y="1807.4707">WindowManagerImpl</text><ellipse cx="956.5" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="944.5" x2="968.5" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1034.5" y="86.1738">WindowManagerGlobal</text><ellipse cx="1110.5" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1098.5" x2="1122.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1034.5" y="1807.4707">WindowManagerGlobal</text><ellipse cx="1110.5" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1098.5" x2="1122.5" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="1359.5" y="86.1738">ViewRootImpl</text><ellipse cx="1404.5" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1392.5" x2="1416.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="1359.5" y="1807.4707">ViewRootImpl</text><ellipse cx="1404.5" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1392.5" x2="1416.5" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1711" y="86.1738">Choreographer</text><ellipse cx="1762.5" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1750.5" x2="1774.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1711" y="1807.4707">Choreographer</text><ellipse cx="1762.5" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1750.5" x2="1774.5" y1="1840.5469" y2="1840.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="1824" y="86.1738">IWindowSession</text><ellipse cx="1878" cy="55.6406" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1866" x2="1890" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="1824" y="1807.4707">IWindowSession</text><ellipse cx="1878" cy="1826.5469" fill="#FEFECE" filter="url(#f1q64d7xlx6ts4)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1866" x2="1890" y1="1840.5469" y2="1840.5469"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="1228.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="127" y="399.4688"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="873.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="132" y="753.6875"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="137" y="797.0391"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="93.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="441" y="434.8203"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="143.582" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="441" y="558.5781"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="441" y="1592.1797"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="100.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661" y="602.1055"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="666" y="653.6328"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="40.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="951.5" y="903.2695"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="613.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1105.5" y="943.7969"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="186.1094" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="990.5"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="344.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="1211.9609"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="78.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1404.5" y="1250.3125"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1409.5" y="1293.6641"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="91.8789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1399.5" y="1670.8828"/><rect fill="#FFFFFF" filter="url(#f1q64d7xlx6ts4)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1404.5" y="1714.2344"/><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="569,104.25,763,104.25,773,132.25,763,161.25,569,161.25,559,132.25,569,104.25" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="571" y="121.7451">Window 的实现类，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="571" y="138.0967">包含一个 DecorView</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="571" y="154.4482">功能：给view包裹一层DecorView</text><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="751,171.3047,932,171.3047,942,191.3047,932,211.3047,751,211.3047,741,191.3047,751,171.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="753" y="188.7998">Activity的根View。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="753" y="205.1514">包含：TitleView、ContentView</text><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="909,222.0078,1004,222.0078,1014,234.0078,1004,246.0078,909,246.0078,899,234.0078,909,222.0078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="911" y="239.5029">管理所有的窗口</text><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="1343,256.3594,1466,256.3594,1476,276.3594,1466,296.3594,1343,296.3594,1333,276.3594,1343,256.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1345" y="273.8545">实现View树的绘制，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1345" y="290.2061">有三个关键方法。</text><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="1770,307.0625,1986,307.0625,1996,335.0625,1986,364.0625,1770,364.0625,1760,335.0625,1770,307.0625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1772" y="324.5576">WMS中Session的Binder代理对象 。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1772" y="340.9092">每个应用进程只有唯一的 Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1776" y="357.2607">对象与 WMS 通信。</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="132" x2="179" y1="386.4688" y2="386.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="179" x2="179" y1="386.4688" y2="399.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="138" x2="179" y1="399.4688" y2="399.4688"/><polygon fill="#A80036" points="148,395.4688,138,399.4688,148,403.4688,144,399.4688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="144" y="381.6123">handleLaunchActivity()</text><polygon fill="#A80036" points="429,430.8203,439,434.8203,429,438.8203,433,434.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="435" y1="434.8203" y2="434.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="144" y="429.9639">xxx -&gt; attach()</text><polygon fill="#A80036" points="654,477.5234,664,481.5234,654,485.5234,658,481.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="451" x2="660" y1="481.5234" y2="481.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="458" y="460.3154">mWindow =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="458" y="476.667">new PhoneWindow();</text><polygon fill="#A80036" points="654,524.2266,664,528.2266,654,532.2266,658,528.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="446" x2="660" y1="528.2266" y2="528.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="453" y="507.0186">mWindowManager =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="457" y="523.3701">mWindow.getWindowManager();</text><polygon fill="#A80036" points="429,554.5781,439,558.5781,429,562.5781,433,558.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="435" y1="558.5781" y2="558.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="144" y="553.7217">xxx -&gt; onCreate()</text><polygon fill="#A80036" points="649,598.1055,659,602.1055,649,606.1055,653,602.1055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="451" x2="655" y1="602.1055" y2="602.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="458" y="597.249">setContentView()</text><path d="M257,571.5781 L257,613.5781 L432,613.5781 L432,581.5781 L422,571.5781 L257,571.5781 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M422,571.5781 L422,581.5781 L432,581.5781 L422,571.5781 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="263" y="590.0732">建立view tree的数据结构，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="263" y="606.4248">还没有真正显示</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="671" x2="718" y1="640.6328" y2="640.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="718" x2="718" y1="640.6328" y2="653.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="677" x2="718" y1="653.6328" y2="653.6328"/><polygon fill="#A80036" points="687,649.6328,677,653.6328,687,657.6328,683,653.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="683" y="635.7764">installDecor()</text><polygon fill="#A80036" points="830,698.1602,840,702.1602,830,706.1602,834,702.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="666" x2="836" y1="702.1602" y2="702.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="673" y="697.3037">mDecor.setWindow(this)</text><path d="M847,671.6328 L847,713.6328 L985,713.6328 L985,681.6328 L975,671.6328 L847,671.6328 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M975,671.6328 L975,681.6328 L985,681.6328 L975,671.6328 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="853" y="690.1279">DecorView和window</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="853" y="706.4795">相互持有</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="137" x2="184" y1="740.6875" y2="740.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="184" x2="184" y1="740.6875" y2="753.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="143" x2="184" y1="753.6875" y2="753.6875"/><polygon fill="#A80036" points="153,749.6875,143,753.6875,153,757.6875,149,753.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="149" y="735.8311">xxx -&gt; handleResumeActivity()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="189" y1="784.0391" y2="784.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="784.0391" y2="797.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="797.0391" y2="797.0391"/><polygon fill="#A80036" points="158,793.0391,148,797.0391,158,801.0391,154,797.0391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="154" y="779.1826">ActivityRecordClient r =  performResumeActivity()</text><polygon fill="#A80036" points="434,828.3906,444,832.3906,434,836.3906,438,832.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="440" y1="832.3906" y2="832.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="154" y="827.5342">xxx -&gt; onStart()</text><polygon fill="#A80036" points="434,858.7422,444,862.7422,434,866.7422,438,862.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="440" y1="862.7422" y2="862.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="149" y="857.8857">xxx -&gt; onResume()</text><polygon fill="#008000" points="939.5,899.2695,949.5,903.2695,939.5,907.2695,943.5,903.2695" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="142" x2="945.5" y1="903.2695" y2="903.2695"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="149" y="898.4131">wm.addView(decor, l);</text><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="18,875.7422,112,875.7422,122,895.7422,112,915.7422,18,915.7422,8,895.7422,18,875.7422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="20" y="893.2373">关键步骤：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="20" y="909.5889">把view加入wms</text><polygon fill="#A80036" points="1093.5,939.7969,1103.5,943.7969,1093.5,947.7969,1097.5,943.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="956.5" x2="1099.5" y1="943.7969" y2="943.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="963.5" y="938.9404">addView();</text><polygon fill="#A80036" points="1387.5,986.5,1397.5,990.5,1387.5,994.5,1391.5,990.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115.5" x2="1393.5" y1="990.5" y2="990.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="1122.5" y="969.292">root =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="1122.5" y="985.6436">new ViewRootImpl()</text><polygon fill="#CCFFE5" filter="url(#f1q64d7xlx6ts4)" points="1363,1003.5,1445,1003.5,1455,1015.5,1445,1027.5,1363,1027.5,1353,1015.5,1363,1003.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1365" y="1020.9951">当前是主线程</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1451.5" y1="1055.2031" y2="1055.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1451.5" x2="1451.5" y1="1055.2031" y2="1068.2031"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1410.5" x2="1451.5" y1="1068.2031" y2="1068.2031"/><polygon fill="#A80036" points="1420.5,1064.2031,1410.5,1068.2031,1420.5,1072.2031,1416.5,1068.2031" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1416.5" y="1050.3467">mThread = Thread.currentThread();</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1451.5" y1="1105.2305" y2="1105.2305"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1451.5" x2="1451.5" y1="1105.2305" y2="1118.2305"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1410.5" x2="1451.5" y1="1118.2305" y2="1118.2305"/><polygon fill="#A80036" points="1420.5,1114.2305,1410.5,1118.2305,1420.5,1122.2305,1416.5,1118.2305" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1416.5" y="1100.374">mWindow = new W(this);</text><path d="M1224,1081.2031 L1224,1123.2031 L1390,1123.2031 L1390,1091.2031 L1380,1081.2031 L1224,1081.2031 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1380,1081.2031 L1380,1091.2031 L1390,1091.2031 L1380,1081.2031 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1230" y="1099.6982">数据类型为IWindow.Stub</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1230" y="1116.0498">在wms中代表应用端</text><polygon fill="#A80036" points="1126.5,1172.6094,1116.5,1176.6094,1126.5,1180.6094,1122.5,1176.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1120.5" x2="1403.5" y1="1176.6094" y2="1176.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1132.5" y="1155.4014">mWindowSession =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="1132.5" y="1171.7529">WindowManagerGlobal.getWindowSession();</text><path d="M1414,1137.9063 L1414,1179.9063 L1664,1179.9063 L1664,1147.9063 L1654,1137.9063 L1414,1137.9063 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1654,1137.9063 L1654,1147.9063 L1664,1147.9063 L1654,1137.9063 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1420" y="1156.4014">数据类型为IWindowSession,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1420" y="1172.7529">同一进程只对应唯一Session代理对象。</text><polygon fill="#A80036" points="1387.5,1207.9609,1397.5,1211.9609,1387.5,1215.9609,1391.5,1211.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1115.5" x2="1393.5" y1="1211.9609" y2="1211.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="1122.5" y="1207.1045">root.setView(View view)//比如DecorView</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1456.5" y1="1237.3125" y2="1237.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1456.5" x2="1456.5" y1="1237.3125" y2="1250.3125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1415.5" x2="1456.5" y1="1250.3125" y2="1250.3125"/><polygon fill="#A80036" points="1425.5,1246.3125,1415.5,1250.3125,1425.5,1254.3125,1421.5,1250.3125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="1421.5" y="1232.4561">requestLayout()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1414.5" x2="1461.5" y1="1280.6641" y2="1280.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1461.5" x2="1461.5" y1="1280.6641" y2="1293.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1420.5" x2="1461.5" y1="1293.6641" y2="1293.6641"/><polygon fill="#A80036" points="1430.5,1289.6641,1420.5,1293.6641,1430.5,1297.6641,1426.5,1293.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1426.5" y="1275.8076">scheduleTraversals()</text><polygon fill="#A80036" points="1750.5,1325.0156,1760.5,1329.0156,1750.5,1333.0156,1754.5,1329.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1756.5" y1="1329.0156" y2="1329.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="1416.5" y="1324.1592">mChoreographer.postCallback(… ,mTraversalRunnable)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1451.5" y1="1359.3672" y2="1359.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1451.5" x2="1451.5" y1="1359.3672" y2="1372.3672"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1410.5" x2="1451.5" y1="1372.3672" y2="1372.3672"/><polygon fill="#A80036" points="1420.5,1368.3672,1410.5,1372.3672,1420.5,1376.3672,1416.5,1372.3672" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="1416.5" y="1354.5107">mInputChannel = new InputChannel();</text><polygon fill="#A80036" points="1866,1411.8945,1876,1415.8945,1866,1419.8945,1870,1415.8945" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1872" y1="1415.8945" y2="1415.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1416.5" y="1411.0381">mWindowSession.addToDisplay(mWindow, ...mInputChannel)</text><path d="M1203,1385.3672 L1203,1427.3672 L1390,1427.3672 L1390,1395.3672 L1380,1385.3672 L1203,1385.3672 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1380,1385.3672 L1380,1395.3672 L1390,1395.3672 L1380,1385.3672 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="1209" y="1403.8623">和wms可以双向通信了</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1209" y="1420.2139">同时完成InputChannel的注册</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1451.5" y1="1508.4766" y2="1508.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1451.5" x2="1451.5" y1="1508.4766" y2="1521.4766"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1410.5" x2="1451.5" y1="1521.4766" y2="1521.4766"/><polygon fill="#A80036" points="1420.5,1517.4766,1410.5,1521.4766,1420.5,1525.4766,1416.5,1521.4766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1416.5" y="1454.5654">SyntheticInputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="1420.5" y="1470.917">ViewPostImeInputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1420.5" y="1487.2686">NativePostImeInputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="1420.5" y="1503.6201">...</text><path d="M1265,1468.0977 L1265,1494.0977 L1390,1494.0977 L1390,1478.0977 L1380,1468.0977 L1265,1468.0977 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1380,1468.0977 L1380,1478.0977 L1390,1478.0977 L1380,1468.0977 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1271" y="1486.5928">对责任链进行组装</text><polygon fill="#A80036" points="853,1552.8281,843,1556.8281,853,1560.8281,849,1556.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="847" x2="1403.5" y1="1556.8281" y2="1556.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="859" y="1551.9717">assignParent(this)</text><path d="M585,1534.4766 L585,1560.4766 L833,1560.4766 L833,1544.4766 L823,1534.4766 L585,1534.4766 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M823,1534.4766 L823,1544.4766 L833,1544.4766 L823,1534.4766 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="591" y="1552.9717">终于终于，mDecor知道了自己父亲是谁</text><polygon fill="#A80036" points="429,1588.1797,439,1592.1797,429,1596.1797,433,1592.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="435" y1="1592.1797" y2="1592.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="149" y="1587.3232">r.activity.makeVisible();</text><polygon fill="#A80036" points="830,1623.5313,840,1627.5313,830,1631.5313,834,1627.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="446" x2="836" y1="1627.5313" y2="1627.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="453" y="1622.6748">mDecor.makeVisible</text><path d="M847,1605.1797 L847,1631.1797 L918,1631.1797 L918,1615.1797 L908,1605.1797 L847,1605.1797 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M908,1605.1797 L908,1615.1797 L918,1615.1797 L908,1605.1797 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="853" y="1623.6748">view可见</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1404.5" x2="1451.5" y1="1657.8828" y2="1657.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1451.5" x2="1451.5" y1="1657.8828" y2="1670.8828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1410.5" x2="1451.5" y1="1670.8828" y2="1670.8828"/><polygon fill="#A80036" points="1420.5,1666.8828,1410.5,1670.8828,1420.5,1674.8828,1416.5,1670.8828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1416.5" y="1653.0264">performTraversals()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1409.5" x2="1456.5" y1="1701.2344" y2="1701.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1456.5" x2="1456.5" y1="1701.2344" y2="1714.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1415.5" x2="1456.5" y1="1714.2344" y2="1714.2344"/><polygon fill="#A80036" points="1425.5,1710.2344,1415.5,1714.2344,1425.5,1718.2344,1421.5,1714.2344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="1421.5" y="1696.3779">relayoutWindow()</text><polygon fill="#A80036" points="1866,1758.7617,1876,1762.7617,1866,1766.7617,1870,1762.7617" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1404.5" x2="1872" y1="1762.7617" y2="1762.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1411.5" y="1757.9053">mWindowSession.relayout(..., mSurface)</text><path d="M1086,1732.2344 L1086,1774.2344 L1390,1774.2344 L1390,1742.2344 L1380,1732.2344 L1086,1732.2344 " fill="#FBFB77" filter="url(#f1q64d7xlx6ts4)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1380,1732.2344 L1380,1742.2344 L1390,1742.2344 L1380,1732.2344 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1092" y="1750.7295">申请Surface，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1092" y="1767.0811">有了Surface才可以把绘制的内容写入其中的buffer</text><!--MD5=[5b0638dd0c2a3f4e1f3ee106bee77949]
@startuml


title __DecorView绑定-调用关系__


entity ActivityThread
entity Activity
entity PhoneWindow

entity DecorView
entity WindowManagerImpl as WindowManager
entity WindowManagerGlobal

entity ViewRootImpl

entity Choreographer
entity IWindowSession

hnote over PhoneWindow#ccffe5: Window 的实现类，\n包含一个 DecorView\n功能：给view包裹一层DecorView
hnote over DecorView#ccffe5: Activity的根View。\n包含：TitleView、ContentView
hnote over WindowManager#ccffe5: 管理所有的窗口
hnote over ViewRootImpl#ccffe5: 实现View树的绘制，\n有三个关键方法。
hnote over IWindowSession#ccffe5: WMS中Session的Binder代理对象 。\n每个应用进程只有唯一的 Session\n 对象与 WMS 通信。


ActivityThread -> ActivityThread: handleLaunchActivity()
activate ActivityThread

    ActivityThread -> Activity: xxx -> attach()
    activate Activity
        Activity -> PhoneWindow: mWindow =\nnew PhoneWindow();
        Activity -> PhoneWindow: mWindowManager =\n mWindow.getWindowManager();
    deactivate Activity

    ActivityThread -> Activity: xxx -> onCreate()
    activate Activity
        Activity -> PhoneWindow: setContentView()
        note left : 建立view tree的数据结构，\n还没有真正显示
        activate PhoneWindow
            PhoneWindow -> PhoneWindow: installDecor()
            activate PhoneWindow
                PhoneWindow -> DecorView: mDecor.setWindow(this)
            deactivate PhoneWindow
            note right : DecorView和window\n相互持有
        deactivate PhoneWindow
    deactivate Activity

    ActivityThread -> ActivityThread: xxx -> handleResumeActivity()
    activate ActivityThread
        ActivityThread -> ActivityThread: ActivityRecordClient r =  performResumeActivity()
        activate ActivityThread
            ActivityThread -> Activity: xxx -> onStart()
            ActivityThread -> Activity: xxx -> onResume()
        deactivate ActivityThread

        ActivityThread [#green]-> WindowManager: wm.addView(decor, l);
        hnote left#ccffe5 : 关键步骤：\n把view加入wms
        activate WindowManager
            WindowManager -> WindowManagerGlobal: addView();
        deactivate WindowManager
        activate WindowManagerGlobal
            WindowManagerGlobal -> ViewRootImpl: root = \nnew ViewRootImpl()
            activate ViewRootImpl
                hnote over ViewRootImpl#ccffe5: 当前是主线程
                ViewRootImpl -> ViewRootImpl: mThread = Thread.currentThread();
                ViewRootImpl -> ViewRootImpl: mWindow = new W(this);
                note left : 数据类型为IWindow.Stub\n在wms中代表应用端
                ViewRootImpl -> WindowManagerGlobal: mWindowSession = \nWindowManagerGlobal.getWindowSession();
                note right : 数据类型为IWindowSession, \n同一进程只对应唯一Session代理对象。
            deactivate ViewRootImpl
            WindowManagerGlobal -> ViewRootImpl: root.setView(View view)//比如DecorView
            activate ViewRootImpl
                ViewRootImpl -> ViewRootImpl: requestLayout()
                activate ViewRootImpl
                    ViewRootImpl -> ViewRootImpl: scheduleTraversals()
                    activate ViewRootImpl
                        ViewRootImpl -> Choreographer: mChoreographer.postCallback(… ,mTraversalRunnable)
                    deactivate ViewRootImpl
                deactivate ViewRootImpl

                ViewRootImpl -> ViewRootImpl: mInputChannel = new InputChannel();
                ViewRootImpl -> IWindowSession: mWindowSession.addToDisplay(mWindow, ...mInputChannel)
                note left : 和wms可以双向通信了\n同时完成InputChannel的注册

                ViewRootImpl -> ViewRootImpl: SyntheticInputStage\n ViewPostImeInputStage\n NativePostImeInputStage\n ...
                note left : 对责任链进行组装
                ViewRootImpl -> DecorView: assignParent(this)
                note left : 终于终于，mDecor知道了自己父亲是谁
            deactivate ViewRootImpl
        deactivate WindowManagerGlobal
        ActivityThread -> Activity: r.activity.makeVisible();
        activate Activity
            Activity -> DecorView : mDecor.makeVisible
            note right : view可见
        deactivate Activity
    deactivate ActivityThread
deactivate ActivityThread


ViewRootImpl -> ViewRootImpl: performTraversals()
activate ViewRootImpl
    ViewRootImpl -> ViewRootImpl: relayoutWindow()
    activate ViewRootImpl
        ViewRootImpl -> IWindowSession: mWindowSession.relayout(..., mSurface)
        note left : 申请Surface，\n有了Surface才可以把绘制的内容写入其中的buffer
    deactivate ViewRootImpl
deactivate ViewRootImpl
@enduml

PlantUML version 1.2020.06(Sun Apr 05 20:38:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Windows 10
Default Encoding: UTF8
Language: zh
Country: CN
--></g></svg>