<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1695px" preserveAspectRatio="none" style="width:870px;height:1695px;" version="1.1" viewBox="0 0 870 1695" width="870px" zoomAndPan="magnify"><defs><filter height="300%" id="ful8yki3bnqj5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="133" x="369.25" y="28.6855">Android启动过程</text><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="29" y="230.6172"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="285.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="262.5" y="694.8906"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="106.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="267.5" y="874"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="378.543" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="567.5" y="1126.1367"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="78.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="572.5" y="1355.2734"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="577.5" y="1398.625"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="109.4063" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="186" y="311.3203"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="172.1094" style="stroke: #000000; stroke-width: 2.0;" width="365.5" x="159" y="434.7266"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="61.7031" style="stroke: #000000; stroke-width: 2.0;" width="270" x="219" y="1604.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="34" x2="34" y1="106.8594" y2="1683.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="167" x2="167" y1="106.8594" y2="1683.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="267" x2="267" y1="106.8594" y2="1683.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="572.5" x2="572.5" y1="106.8594" y2="1683.0859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="824.5" x2="824.5" y1="106.8594" y2="1683.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="46" x="8" y="103.7832">Init进程</text><ellipse cx="34" cy="73.25" fill="#FEFECE" filter="url(#ful8yki3bnqj5)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="22" x2="46" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="122" y="86.1738">其它系统服务</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="33" x="115" y="103.7832">(都有</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="148" y="103.7832">独立进程</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="5" x="208" y="103.7832">)</text><ellipse cx="167" cy="55.6406" fill="#FEFECE" filter="url(#ful8yki3bnqj5)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="155" x2="179" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="229" y="103.7832">Zygote进程</text><ellipse cx="267.5" cy="73.25" fill="#FEFECE" filter="url(#ful8yki3bnqj5)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="255.5" x2="279.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="511.5" y="103.7832">SystemServer进程</text><ellipse cx="572.5" cy="73.25" fill="#FEFECE" filter="url(#ful8yki3bnqj5)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="560.5" x2="584.5" y1="87.25" y2="87.25"/><rect fill="#FEFECE" filter="url(#ful8yki3bnqj5)" height="31.6094" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="785.5" y="70.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="792.5" y="91.7832">Launcher</text><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="29" y="230.6172"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="285.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="262.5" y="694.8906"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="106.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="267.5" y="874"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="378.543" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="567.5" y="1126.1367"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="78.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="572.5" y="1355.2734"/><rect fill="#FFFFFF" filter="url(#ful8yki3bnqj5)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="577.5" y="1398.625"/><polygon fill="#FBFB77" filter="url(#ful8yki3bnqj5)" points="109,121.8594,224,121.8594,234,157.8594,224,194.8594,109,194.8594,99,157.8594,109,121.8594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="111" y="139.3545">servicemanager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="115" y="155.7061">surfaceflinger</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="115" y="172.0576">media、drm</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="115" y="188.4092">bootanim、installd</text><line style="stroke: #008000; stroke-width: 1.0;" x1="34" x2="81" y1="217.6172" y2="217.6172"/><line style="stroke: #008000; stroke-width: 1.0;" x1="81" x2="81" y1="217.6172" y2="230.6172"/><line style="stroke: #008000; stroke-width: 1.0;" x1="40" x2="81" y1="230.6172" y2="230.6172"/><polygon fill="#008000" points="50,226.6172,40,230.6172,50,234.6172,46,230.6172" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="46" y="212.7607">init.rc 文件解析</text><polygon fill="#008000" points="255.5,261.9688,265.5,265.9688,255.5,269.9688,259.5,265.9688" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="39" x2="261.5" y1="265.9688" y2="265.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="46" y="261.1123">启动Zygote</text><polygon fill="#A80036" points="155,292.3203,165,296.3203,155,300.3203,159,296.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="34" x2="161" y1="296.3203" y2="296.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="41" y="291.4639">启动其它系统服务</text><path d="M186,311.3203 L321,311.3203 L321,319.3203 L311,329.3203 L186,329.3203 L186,311.3203 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="109.4063" style="stroke: #000000; stroke-width: 2.0;" width="358.5" x="186" y="311.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="201" y="325.8154">app_main.cpp</text><polygon fill="#CCFFE5" filter="url(#ful8yki3bnqj5)" points="206,334.6719,329,334.6719,339,346.6719,329,358.6719,206,358.6719,196,346.6719,206,334.6719" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="208" y="352.167">三部曲：1. 启动进程</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="309.5" y1="393.0508" y2="393.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="309.5" y1="393.0508" y2="406.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="268.5" x2="309.5" y1="406.0508" y2="406.0508"/><polygon fill="#A80036" points="278.5,402.0508,268.5,406.0508,278.5,410.0508,274.5,406.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="274.5" y="388.1943">启动Zygote</text><path d="M351,369.0234 L351,411.0234 L525,411.0234 L525,379.0234 L515,369.0234 L351,369.0234 " fill="#FBFB77" filter="url(#ful8yki3bnqj5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M515,369.0234 L515,379.0234 L525,379.0234 L515,369.0234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="357" y="387.5186">这是zygote模式。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="357" y="403.8701">另外还有application模式。</text><path d="M159,434.7266 L334,434.7266 L334,442.7266 L324,452.7266 L159,452.7266 L159,434.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="172.1094" style="stroke: #000000; stroke-width: 2.0;" width="365.5" x="159" y="434.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="174" y="449.2217">AndroidRuntime.cpp</text><polygon fill="#CCFFE5" filter="url(#ful8yki3bnqj5)" points="179,458.0781,356,458.0781,366,470.0781,356,482.0781,179,482.0781,169,470.0781,179,458.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="181" y="475.5732">三部曲：2. 初始化(native部分)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="309.5" y1="526.1328" y2="526.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="309.5" y1="526.1328" y2="539.1328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="268.5" x2="309.5" y1="539.1328" y2="539.1328"/><polygon fill="#A80036" points="278.5,535.1328,268.5,539.1328,278.5,543.1328,274.5,539.1328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="274.5" y="504.9248">1、startVm函数：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="274.5" y="521.2764">启动Android虚拟机，JNI_CreateJavaVM()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="309.5" y1="585.8359" y2="585.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="309.5" y1="585.8359" y2="598.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="268.5" x2="309.5" y1="598.8359" y2="598.8359"/><polygon fill="#A80036" points="278.5,594.8359,268.5,598.8359,278.5,602.8359,274.5,598.8359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="274.5" y="564.6279">2、startReg函数：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="274.5" y="580.9795">注册Android的JNI函数</text><polygon fill="#CCFFE5" filter="url(#ful8yki3bnqj5)" points="184,618.8359,350,618.8359,360,630.8359,350,642.8359,184,642.8359,174,630.8359,184,618.8359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="186" y="636.3311">三部曲：2. 初始化(java部分)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="314.5" y1="681.8906" y2="681.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="314.5" x2="314.5" y1="681.8906" y2="694.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="273.5" x2="314.5" y1="694.8906" y2="694.8906"/><polygon fill="#A80036" points="283.5,690.8906,273.5,694.8906,283.5,698.8906,279.5,694.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="279.5" y="660.6826">3、进入Java世界：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="283.5" y="677.0342">ZygoteInit.main()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="272.5" x2="314.5" y1="746.5938" y2="746.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="314.5" x2="314.5" y1="746.5938" y2="759.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="273.5" x2="314.5" y1="759.5938" y2="759.5938"/><polygon fill="#A80036" points="283.5,755.5938,273.5,759.5938,283.5,763.5938,279.5,759.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="279.5" y="725.3857">创建一个Server端的Socket：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="283.5" y="741.7373">zygoteServer#registerServerSocketFromEnv()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="272.5" x2="314.5" y1="806.2969" y2="806.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="314.5" x2="314.5" y1="806.2969" y2="819.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="273.5" x2="314.5" y1="819.2969" y2="819.2969"/><polygon fill="#A80036" points="283.5,815.2969,273.5,819.2969,283.5,823.2969,279.5,819.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="279.5" y="785.0889">预加载资源、常用类、共享库、OpenGL、HAL：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="283.5" y="801.4404">preload()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="272.5" x2="319.5" y1="861" y2="861"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="319.5" x2="319.5" y1="861" y2="874"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="278.5" x2="319.5" y1="874" y2="874"/><polygon fill="#A80036" points="288.5,870,278.5,874,288.5,878,284.5,874" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="284.5" y="839.792">fork出SystemServer进程：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="288.5" y="856.1436">Zygote.forkSystemServer()</text><polygon fill="#88EEFF" filter="url(#ful8yki3bnqj5)" points="511,892,634,892,644,904,634,916,511,916,501,904,511,892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="513" y="909.4951">三部曲：1. 启动进程</text><polygon fill="#A80036" points="560.5,939.7031,570.5,943.7031,560.5,947.7031,564.5,943.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="277.5" x2="566.5" y1="943.7031" y2="943.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="284.5" y="938.8467">子进程</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="277.5" x2="319.5" y1="979.0547" y2="979.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="319.5" x2="319.5" y1="979.0547" y2="992.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="272.5" x2="319.5" y1="992.0547" y2="992.0547"/><polygon fill="#A80036" points="282.5,988.0547,272.5,992.0547,282.5,996.0547,278.5,992.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="284.5" y="974.1982">父进程</text><polygon fill="#88EEFF" filter="url(#ful8yki3bnqj5)" points="517,1000.0547,627,1000.0547,637,1012.0547,627,1024.0547,517,1024.0547,507,1012.0547,517,1000.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="519" y="1017.5498">三部曲：2. 初始化</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="572.5" x2="614.5" y1="1068.1094" y2="1068.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="614.5" x2="614.5" y1="1068.1094" y2="1081.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="573.5" x2="614.5" y1="1081.1094" y2="1081.1094"/><polygon fill="#A80036" points="583.5,1077.1094,573.5,1081.1094,583.5,1085.1094,579.5,1081.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="579.5" y="1046.9014">1、启动Binder机制：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="583.5" y="1063.2529">ZygoteInit.nativeZygoteInit();</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="572.5" x2="619.5" y1="1113.1367" y2="1113.1367"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619.5" x2="619.5" y1="1113.1367" y2="1126.1367"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="578.5" x2="619.5" y1="1126.1367" y2="1126.1367"/><polygon fill="#A80036" points="588.5,1122.1367,578.5,1126.1367,588.5,1130.1367,584.5,1126.1367" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="584.5" y="1108.2803">2、调用入口函数SystemServer.main()</text><path d="M416,1094.1094 L416,1136.1094 L558,1136.1094 L558,1104.1094 L548,1094.1094 L416,1094.1094 " fill="#FBFB77" filter="url(#ful8yki3bnqj5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M548,1094.1094 L548,1104.1094 L558,1104.1094 L548,1094.1094 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="422" y="1112.6045">和普通的应用一样，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="422" y="1128.9561">looper、 context都有</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="619.5" y1="1184.5156" y2="1184.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619.5" x2="619.5" y1="1184.5156" y2="1197.5156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="578.5" x2="619.5" y1="1197.5156" y2="1197.5156"/><polygon fill="#A80036" points="588.5,1193.5156,578.5,1197.5156,588.5,1201.5156,584.5,1197.5156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="584.5" y="1163.3076">Prepare the main looper thread ：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="588.5" y="1179.6592">Looper.prepareMainLooper();</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="619.5" y1="1244.2188" y2="1244.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619.5" x2="619.5" y1="1244.2188" y2="1257.2188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="578.5" x2="619.5" y1="1257.2188" y2="1257.2188"/><polygon fill="#A80036" points="588.5,1253.2188,578.5,1257.2188,588.5,1261.2188,584.5,1257.2188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="584.5" y="1223.0107">Initialize native services ：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="588.5" y="1239.3623">System.loadLibrary("android_servers");</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="619.5" y1="1287.5703" y2="1287.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619.5" x2="619.5" y1="1287.5703" y2="1300.5703"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="578.5" x2="619.5" y1="1300.5703" y2="1300.5703"/><polygon fill="#A80036" points="588.5,1296.5703,578.5,1300.5703,588.5,1304.5703,584.5,1300.5703" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="584.5" y="1282.7139">createSystemContext();</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="624.5" y1="1342.2734" y2="1342.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="624.5" x2="624.5" y1="1342.2734" y2="1355.2734"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="583.5" x2="624.5" y1="1355.2734" y2="1355.2734"/><polygon fill="#A80036" points="593.5,1351.2734,583.5,1355.2734,593.5,1359.2734,589.5,1355.2734" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="589.5" y="1321.0654">startXXXServices（分批启动）：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="593.5" y="1337.417">Bootstrap、Core、Other;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="582.5" x2="629.5" y1="1385.625" y2="1385.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="629.5" x2="629.5" y1="1385.625" y2="1398.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="588.5" x2="629.5" y1="1398.625" y2="1398.625"/><polygon fill="#A80036" points="598.5,1394.625,588.5,1398.625,598.5,1402.625,594.5,1398.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="594.5" y="1380.7686">systemReady();</text><polygon fill="#A80036" points="812.5,1429.9766,822.5,1433.9766,812.5,1437.9766,816.5,1433.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="818.5" y1="1433.9766" y2="1433.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="584.5" y="1429.1201">启动Launcher</text><polygon fill="#88EEFF" filter="url(#ful8yki3bnqj5)" points="511,1446.9766,634,1446.9766,644,1458.9766,634,1470.9766,511,1470.9766,501,1458.9766,511,1446.9766" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="513" y="1464.4717">三部曲：3. 消息循环</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="577.5" x2="619.5" y1="1503.6797" y2="1503.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="619.5" x2="619.5" y1="1503.6797" y2="1516.6797"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="572.5" x2="619.5" y1="1516.6797" y2="1516.6797"/><polygon fill="#A80036" points="582.5,1512.6797,572.5,1516.6797,582.5,1520.6797,578.5,1516.6797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="584.5" y="1498.8232">Looper.loop()</text><polygon fill="#CCFFE5" filter="url(#ful8yki3bnqj5)" points="206,1524.6797,329,1524.6797,339,1536.6797,329,1548.6797,206,1548.6797,196,1536.6797,206,1524.6797" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="208" y="1542.1748">三部曲：3. 消息循环</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="309.5" y1="1576.3828" y2="1576.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="309.5" y1="1576.3828" y2="1589.3828"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="268.5" x2="309.5" y1="1589.3828" y2="1589.3828"/><polygon fill="#A80036" points="278.5,1585.3828,268.5,1589.3828,278.5,1593.3828,274.5,1589.3828" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="274.5" y="1571.5264">zygoteServer#runSelectLoop()</text><path d="M219,1604.3828 L292,1604.3828 L292,1612.3828 L282,1622.3828 L219,1622.3828 L219,1604.3828 " fill="#CCFFE5" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="61.7031" style="stroke: #000000; stroke-width: 2.0;" width="270" x="219" y="1604.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="234" y="1618.8779">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="307" y="1617.8018">[等待socket消息，fork应用进程]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="309.5" y1="1645.0859" y2="1645.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="309.5" x2="309.5" y1="1645.0859" y2="1658.0859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="268.5" x2="309.5" y1="1658.0859" y2="1658.0859"/><polygon fill="#A80036" points="278.5,1654.0859,268.5,1658.0859,278.5,1662.0859,274.5,1658.0859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="274.5" y="1640.2295">Zygote.forkAndSpecialize()</text><!--MD5=[87b44e33767e5dbd8af39dbf5e706314]
@startuml


title __Android启动过程__
hide footbox


entity "Init进程" as Init
entity "其它系统服务\n(都有**独立进程**)" as otherSysProcess
entity "Zygote进程" as Zygote
entity "SystemServer进程" as SystemServer


hnote over otherSysProcess : servicemanager\n surfaceflinger\n media、drm\n bootanim、installd
Init [#green]-> Init: init.rc 文件解析
activate Init
    Init [#green]-> Zygote: 启动Zygote
    Init -> otherSysProcess: 启动其它系统服务
deactivate Init
group app_main.cpp
    hnote over Zygote#ccffe5: 三部曲：1. 启动进程
    Zygote -> Zygote: 启动Zygote
    note right: 这是zygote模式。\n另外还有application模式。

end

group AndroidRuntime.cpp
    hnote over Zygote#ccffe5: 三部曲：2. 初始化(native部分)
    Zygote -> Zygote: 1、startVm函数：\n启动Android虚拟机，JNI_CreateJavaVM()
    Zygote -> Zygote: 2、startReg函数：\n注册Android的JNI函数
end
hnote over Zygote#ccffe5: 三部曲：2. 初始化(java部分)
Zygote -> Zygote: 3、进入Java世界：\n ZygoteInit.main()
activate Zygote
    Zygote -> Zygote: 创建一个Server端的Socket：\n zygoteServer#registerServerSocketFromEnv()
    Zygote -> Zygote: 预加载资源、常用类、共享库、OpenGL、HAL：\n preload()
    Zygote -> Zygote: fork出SystemServer进程：\n Zygote.forkSystemServer()
    activate Zygote
        hnote over SystemServer#88eeff: 三部曲：1. 启动进程
        Zygote -> SystemServer: 子进程
        Zygote -> Zygote: 父进程
    deactivate Zygote
deactivate Zygote
hnote over SystemServer#88eeff: 三部曲：2. 初始化
SystemServer -> SystemServer: 1、启动Binder机制：\n ZygoteInit.nativeZygoteInit();
SystemServer -> SystemServer: 2、调用入口函数SystemServer.main()
activate SystemServer
    note left: 和普通的应用一样，\nlooper、 context都有
    SystemServer -> SystemServer: Prepare the main looper thread ：\n Looper.prepareMainLooper();
    SystemServer -> SystemServer: Initialize native services ：\n System.loadLibrary("android_servers");
    SystemServer -> SystemServer: createSystemContext();

    SystemServer -> SystemServer: startXXXServices（分批启动）：\n Bootstrap、Core、Other;
    activate SystemServer
        SystemServer -> SystemServer: systemReady();
        activate SystemServer
            SystemServer -> Launcher: 启动Launcher
                    deactivate SystemServer
    deactivate SystemServer
    hnote over SystemServer#88eeff: 三部曲：3. 消息循环
    SystemServer -> SystemServer: Looper.loop()
deactivate SystemServer

hnote over Zygote#ccffe5: 三部曲：3. 消息循环
Zygote -> Zygote: zygoteServer#runSelectLoop()
loop#ccffe5 等待socket消息，fork应用进程
    Zygote -> Zygote: Zygote.forkAndSpecialize()
end
@enduml

PlantUML version 1.2020.06(Sun Apr 05 20:38:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Windows 10
Default Encoding: UTF8
Language: zh
Country: CN
--></g></svg>