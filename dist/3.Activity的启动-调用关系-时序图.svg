<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1226px" preserveAspectRatio="none" style="width:1369px;height:1226px;" version="1.1" viewBox="0 0 1369 1226" width="1369px" zoomAndPan="magnify"><defs><filter height="300%" id="fsbon4rvyzwue" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="224" x="571.75" y="28.6855">Activity的启动过程-调用关系</text><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="130.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="230" y="841.3359"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="82.3789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="481.1445"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="658.5781"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="386.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1189.5" y="762.6328"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="196.1094" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="805.9844"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="109.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="1040.4453"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1199.5" y="1083.7969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="105" x2="105" y1="89.25" y2="1167.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="234.5" x2="234.5" y1="89.25" y2="1167.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="427.5" x2="427.5" y1="89.25" y2="1167.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="579.5" x2="579.5" y1="89.25" y2="1167.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="777" x2="777" y1="89.25" y2="1167.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="929" x2="929" y1="89.25" y2="1167.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1194.5" x2="1194.5" y1="89.25" y2="1167.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="72" y="86.1738">Launcher</text><ellipse cx="105" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="93" x2="117" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="72" y="1181.0332">Launcher</text><ellipse cx="105" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="93" x2="117" y1="1214.1094" y2="1214.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="183.5" y="86.1738">Instrumentation</text><ellipse cx="235" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="223" x2="247" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="183.5" y="1181.0332">Instrumentation</text><ellipse cx="235" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="223" x2="247" y1="1214.1094" y2="1214.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="410.5" y="86.1738">AMS</text><ellipse cx="428" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="416" x2="440" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="410.5" y="1181.0332">AMS</text><ellipse cx="428" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="416" x2="440" y1="1214.1094" y2="1214.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="503.5" y="86.1738">ActivityStackSupervisor</text><ellipse cx="580" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="568" x2="592" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="503.5" y="1181.0332">ActivityStackSupervisor</text><ellipse cx="580" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="568" x2="592" y1="1214.1094" y2="1214.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="695" y="86.1738">PackageManagerService</text><ellipse cx="777" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="765" x2="789" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="158" x="695" y="1181.0332">PackageManagerService</text><ellipse cx="777" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="765" x2="789" y1="1214.1094" y2="1214.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="869" y="86.1738">ApplicationThread</text><ellipse cx="929.5" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="917.5" x2="941.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="869" y="1181.0332">ApplicationThread</text><ellipse cx="929.5" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="917.5" x2="941.5" y1="1214.1094" y2="1214.1094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1146.5" y="86.1738">ActivityThread</text><ellipse cx="1194.5" cy="55.6406" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1182.5" x2="1206.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1146.5" y="1181.0332">ActivityThread</text><ellipse cx="1194.5" cy="1200.1094" fill="#FEFECE" filter="url(#fsbon4rvyzwue)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1182.5" x2="1206.5" y1="1214.1094" y2="1214.1094"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="130.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="230" y="841.3359"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="82.3789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="481.1445"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="575" y="658.5781"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="386.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1189.5" y="762.6328"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="196.1094" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="805.9844"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="109.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1194.5" y="1040.4453"/><rect fill="#FFFFFF" filter="url(#fsbon4rvyzwue)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1199.5" y="1083.7969"/><polygon fill="#008000" points="223,117.6016,233,121.6016,223,125.6016,227,121.6016" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="105" x2="229" y1="121.6016" y2="121.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="112" y="116.7451">execStartActivity()</text><polygon fill="#008000" points="416,161.1289,426,165.1289,416,169.1289,420,165.1289" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="235" x2="422" y1="165.1289" y2="165.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="242" y="160.2725">Binder: startActivity()</text><path d="M8,134.6016 L8,176.6016 L226,176.6016 L226,144.6016 L216,134.6016 L8,134.6016 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M216,134.6016 L216,144.6016 L226,144.6016 L216,134.6016 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="14" y="153.0967">ActivityManagerNative.getDefault()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="14" y="169.4482">获取到 AMS的代理</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="428" x2="470" y1="215.332" y2="215.332"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="470" x2="470" y1="215.332" y2="228.332"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429" x2="470" y1="228.332" y2="228.332"/><polygon fill="#A80036" points="439,224.332,429,228.332,439,232.332,435,228.332" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="435" y="210.4756">startActivityAsUser</text><path d="M225,191.3047 L225,233.3047 L419,233.3047 L419,201.3047 L409,191.3047 L225,191.3047 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M409,191.3047 L409,201.3047 L419,201.3047 L409,191.3047 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="231" y="209.7998">UserHandle.getCallingUserId()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="231" y="226.1514">获取到 userId</text><polygon fill="#A80036" points="568,261.3594,578,265.3594,568,269.3594,572,265.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="428" x2="574" y1="265.3594" y2="265.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="435" y="260.5029">startActivityMayWait()</text><polygon fill="#A80036" points="765,291.7109,775,295.7109,765,299.7109,769,295.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="580" x2="771" y1="295.7109" y2="295.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="587" y="290.8545">resolveActivity()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="777" x2="819" y1="326.0625" y2="326.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="819" x2="819" y1="326.0625" y2="339.0625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778" x2="819" y1="339.0625" y2="339.0625"/><polygon fill="#A80036" points="788,335.0625,778,339.0625,788,343.0625,784,339.0625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="784" y="321.2061">queryIntentActivities()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="777" x2="819" y1="376.0898" y2="376.0898"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="819" x2="819" y1="376.0898" y2="389.0898"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="778" x2="819" y1="389.0898" y2="389.0898"/><polygon fill="#A80036" points="788,385.0898,778,389.0898,788,393.0898,784,389.0898" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="784" y="371.2334">chooseBestActivity()</text><path d="M575,352.0625 L575,394.0625 L768,394.0625 L768,362.0625 L758,352.0625 L575,352.0625 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M758,352.0625 L758,362.0625 L768,362.0625 L758,352.0625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="581" y="370.5576">当存在多个满足条件的Activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="581" y="386.9092">则会弹框让用户来选择。</text><polygon fill="#A80036" points="591,427.1172,581,431.1172,591,435.1172,587,431.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="585" x2="776" y1="431.1172" y2="431.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="597" y="426.2607">startActivityLocked()</text><path d="M296,408.7656 L296,434.7656 L571,434.7656 L571,418.7656 L561,408.7656 L296,408.7656 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561,408.7656 L561,418.7656 L571,418.7656 L561,408.7656 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="302" y="427.2607">检查调用者是否有权限来调用指定的 Activity</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="580" x2="627" y1="468.1445" y2="468.1445"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="627" x2="627" y1="468.1445" y2="481.1445"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="586" x2="627" y1="481.1445" y2="481.1445"/><polygon fill="#A80036" points="596,477.1445,586,481.1445,596,485.1445,592,481.1445" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="592" y="463.2881">startActivityUncheckedLocked()</text><path d="M376,449.1172 L376,491.1172 L566,491.1172 L566,459.1172 L556,449.1172 L376,449.1172 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M556,449.1172 L556,459.1172 L566,459.1172 L556,449.1172 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="382" y="467.6123">进行对 launchMode 的处理，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="382" y="483.9639">创建 Task 等操作。</text><polygon fill="#A80036" points="116,524.1719,106,528.1719,116,532.1719,112,528.1719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="110" x2="574" y1="528.1719" y2="528.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="122" y="523.3154">ActivityStack.resumeTopActivityInnerLocked()</text><path d="M590,505.8203 L590,531.8203 L786,531.8203 L786,515.8203 L776,505.8203 L590,505.8203 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M776,505.8203 L776,515.8203 L786,515.8203 L776,505.8203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="596" y="524.3154">通知Launcher进入Paused状态</text><polygon fill="#A80036" points="568,559.5234,578,563.5234,568,567.5234,572,563.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="105" x2="574" y1="563.5234" y2="563.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="112" y="558.667">准备就绪，已经进入Paused状态</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="580" x2="622" y1="600.5508" y2="600.5508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="622" x2="622" y1="600.5508" y2="613.5508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="581" x2="622" y1="613.5508" y2="613.5508"/><polygon fill="#A80036" points="591,609.5508,581,613.5508,591,617.5508,587,613.5508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="587" y="595.6943">startSpecificActivityLocked()</text><path d="M398,576.5234 L398,618.5234 L571,618.5234 L571,586.5234 L561,576.5234 L398,576.5234 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561,576.5234 L561,586.5234 L571,586.5234 L561,576.5234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="404" y="595.0186">启动 Activity 所在进程，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="404" y="611.3701">已存在则直接 onResume()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="580" x2="627" y1="645.5781" y2="645.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="627" x2="627" y1="645.5781" y2="658.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="586" x2="627" y1="658.5781" y2="658.5781"/><polygon fill="#A80036" points="596,654.5781,586,658.5781,596,662.5781,592,658.5781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="592" y="640.7217">realStartActivityLocked()</text><polygon fill="#A80036" points="917.5,689.9297,927.5,693.9297,917.5,697.9297,921.5,693.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="580" x2="923.5" y1="693.9297" y2="693.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="587" y="689.0732">app.thread.scheduleLaunchActivity()</text><polygon fill="#A80036" points="1182.5,720.2813,1192.5,724.2813,1182.5,728.2813,1186.5,724.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="929.5" x2="1188.5" y1="724.2813" y2="724.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="936.5" y="719.4248">mH.sendMessage(H.LAUNCH_ACTIVITY)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1194.5" x2="1241.5" y1="749.6328" y2="749.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1241.5" x2="1241.5" y1="749.6328" y2="762.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1200.5" x2="1241.5" y1="762.6328" y2="762.6328"/><polygon fill="#A80036" points="1210.5,758.6328,1200.5,762.6328,1210.5,766.6328,1206.5,762.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1206.5" y="744.7764">handleLaunchActivity()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1199.5" x2="1246.5" y1="792.9844" y2="792.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246.5" x2="1246.5" y1="792.9844" y2="805.9844"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1205.5" x2="1246.5" y1="805.9844" y2="805.9844"/><polygon fill="#A80036" points="1215.5,801.9844,1205.5,805.9844,1215.5,809.9844,1211.5,805.9844" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="1211.5" y="788.1279">performLaunchActivity()</text><polygon fill="#A80036" points="251,837.3359,241,841.3359,251,845.3359,247,841.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="1193.5" y1="841.3359" y2="841.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="360" x="257" y="836.4795">newActivity(classLoader, component.getClassName(), r.intent)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="282" y1="871.6875" y2="871.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282" x2="282" y1="871.6875" y2="884.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="241" x2="282" y1="884.6875" y2="884.6875"/><polygon fill="#A80036" points="251,880.6875,241,884.6875,251,888.6875,247,884.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="247" y="866.8311">(Activity)clazz.newInstance();</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="282" y1="929.8906" y2="929.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282" x2="282" y1="929.8906" y2="942.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="241" x2="282" y1="942.8906" y2="942.8906"/><polygon fill="#A80036" points="251,938.8906,241,942.8906,251,946.8906,247,942.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="247" y="925.0342">Activity.attach()</text><path d="M78,897.6875 L78,956.6875 L221,956.6875 L221,907.6875 L211,897.6875 L78,897.6875 " fill="#FBFB77" filter="url(#fsbon4rvyzwue)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M211,897.6875 L211,907.6875 L221,907.6875 L211,897.6875 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="84" y="916.1826">1.attachBaseContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="84" y="932.5342">2.初始化Window</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="84" y="948.8857">3.初始化 WMS</text><polygon fill="#A80036" points="1182.5,967.7422,1192.5,971.7422,1182.5,975.7422,1186.5,971.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="235" x2="1188.5" y1="971.7422" y2="971.7422"/><polygon fill="#A80036" points="246,998.0938,236,1002.0938,246,1006.0938,242,1002.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="1188.5" y1="1002.0938" y2="1002.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="264" x="252" y="997.2373">中间通过Activity xxx -&gt; callActivityOnCreate()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1199.5" x2="1246.5" y1="1027.4453" y2="1027.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246.5" x2="1246.5" y1="1027.4453" y2="1040.4453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1205.5" x2="1246.5" y1="1040.4453" y2="1040.4453"/><polygon fill="#A80036" points="1215.5,1036.4453,1205.5,1040.4453,1215.5,1044.4453,1211.5,1040.4453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="1211.5" y="1022.5889">handleResumeActivity()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1204.5" x2="1251.5" y1="1070.7969" y2="1070.7969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1251.5" x2="1251.5" y1="1070.7969" y2="1083.7969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1210.5" x2="1251.5" y1="1083.7969" y2="1083.7969"/><polygon fill="#A80036" points="1220.5,1079.7969,1210.5,1083.7969,1220.5,1087.7969,1216.5,1083.7969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1216.5" y="1065.9404">performResumeActivity()</text><polygon fill="#A80036" points="246,1115.1484,236,1119.1484,246,1123.1484,242,1119.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="1198.5" y1="1119.1484" y2="1119.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="252" y="1114.292">xxx -&gt; callActivityOnStart()</text><polygon fill="#A80036" points="246,1145.5,236,1149.5,246,1153.5,242,1149.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="1193.5" y1="1149.5" y2="1149.5"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="252" y="1144.6436">xxx -&gt; callActivityOnResume()</text><!--MD5=[fd965593135eb8263c90923242d1658d]
@startuml


title __Activity的启动过程-调用关系__


entity "Launcher"
entity Instrumentation
entity AMS
entity ActivityStackSupervisor as ASS
entity PackageManagerService as PKMS
entity ApplicationThread
entity ActivityThread

Launcher [#green]-> Instrumentation: execStartActivity()
Instrumentation [#green]-> AMS: Binder: startActivity()
note left : ActivityManagerNative.getDefault()\n获取到 AMS的代理
AMS -> AMS: startActivityAsUser
note left : UserHandle.getCallingUserId()\n获取到 userId
AMS -> ASS: startActivityMayWait()
ASS -> PKMS: resolveActivity()
PKMS -> PKMS: queryIntentActivities()
PKMS -> PKMS: chooseBestActivity()
note left :当存在多个满足条件的Activity\n则会弹框让用户来选择。
PKMS -> ASS: startActivityLocked()
note left :检查调用者是否有权限来调用指定的 Activity
ASS -> ASS: startActivityUncheckedLocked()
note left :进行对 launchMode 的处理，\n创建 Task 等操作。
activate ASS
    ASS -> Launcher: ActivityStack.resumeTopActivityInnerLocked()
    note right :通知Launcher进入Paused状态
    Launcher - -> ASS: 准备就绪，已经进入Paused状态
deactivate ASS

ASS -> ASS: startSpecificActivityLocked()
note left :启动 Activity 所在进程，\n已存在则直接 onResume()
ASS -> ASS: realStartActivityLocked()
activate ASS
    ASS -> ApplicationThread: app.thread.scheduleLaunchActivity()
deactivate ASS
ApplicationThread -> ActivityThread: mH.sendMessage(H.LAUNCH_ACTIVITY)
ActivityThread -> ActivityThread: handleLaunchActivity()

activate ActivityThread
    ActivityThread -> ActivityThread: performLaunchActivity()
    activate ActivityThread
        ActivityThread -> Instrumentation: newActivity(classLoader, component.getClassName(), r.intent)
            activate Instrumentation
            Instrumentation -> Instrumentation: (Activity)clazz.newInstance();
            Instrumentation -> Instrumentation: Activity.attach()
            note left :1.attachBaseContext\n2.初始化Window\n3.初始化 WMS
            Instrumentation - -> ActivityThread
        deactivate Instrumentation
        ActivityThread -> Instrumentation: 中间通过Activity xxx -> callActivityOnCreate()
    deactivate ActivityThread

    ActivityThread -> ActivityThread: handleResumeActivity()
    activate ActivityThread
        ActivityThread -> ActivityThread: performResumeActivity()
        activate ActivityThread
            ActivityThread -> Instrumentation: xxx -> callActivityOnStart()
            ActivityThread -> Instrumentation: xxx -> callActivityOnResume()
        deactivate ActivityThread
    deactivate ActivityThread
deactivate ActivityThread


@enduml

PlantUML version 1.2020.06(Sun Apr 05 20:38:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Windows 10
Default Encoding: UTF8
Language: zh
Country: CN
--></g></svg>