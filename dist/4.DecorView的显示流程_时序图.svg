<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1004px" preserveAspectRatio="none" style="width:790px;height:1004px;" version="1.1" viewBox="0 0 790 1004" width="790px" zoomAndPan="magnify"><defs><filter height="300%" id="fjk03hm3z102f" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="240" x="277.75" y="28.6855">DecorView的显示流程_时序图</text><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="671.7344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="51" y="265.3594"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="145.7578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="200" y="398.1172"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="107.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="205" y="436.4688"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="94.2305" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="200" y="656.2813"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491.5" y="893.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="56" x2="56" y1="89.25" y2="946.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="205" x2="205" y1="89.25" y2="946.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="404.5" x2="404.5" y1="89.25" y2="946.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="496.5" x2="496.5" y1="89.25" y2="946.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="619.5" x2="619.5" y1="89.25" y2="946.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="8" y="86.1738">ActivityThread</text><ellipse cx="56" cy="55.6406" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="44" x2="68" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="8" y="959.627">ActivityThread</text><ellipse cx="56" cy="978.7031" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="44" x2="68" y1="992.7031" y2="992.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="180" y="86.1738">Activity</text><ellipse cx="205" cy="55.6406" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="193" x2="217" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="180" y="959.627">Activity</text><ellipse cx="205" cy="978.7031" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="193" x2="217" y1="992.7031" y2="992.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="368.5" y="86.1738">DecorView</text><ellipse cx="405" cy="55.6406" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="393" x2="417" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="368.5" y="959.627">DecorView</text><ellipse cx="405" cy="978.7031" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="393" x2="417" y1="992.7031" y2="992.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="451.5" y="86.1738">ViewRootImpl</text><ellipse cx="496.5" cy="55.6406" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="484.5" x2="508.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="451.5" y="959.627">ViewRootImpl</text><ellipse cx="496.5" cy="978.7031" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="484.5" x2="508.5" y1="992.7031" y2="992.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="551.5" y="86.1738">WindowManagerImpl</text><ellipse cx="619.5" cy="55.6406" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="607.5" x2="631.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="551.5" y="959.627">WindowManagerImpl</text><ellipse cx="619.5" cy="978.7031" fill="#FEFECE" filter="url(#fjk03hm3z102f)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="607.5" x2="631.5" y1="992.7031" y2="992.7031"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="671.7344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="51" y="265.3594"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="145.7578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="200" y="398.1172"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="107.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="205" y="436.4688"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="94.2305" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="200" y="656.2813"/><rect fill="#FFFFFF" filter="url(#fjk03hm3z102f)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="491.5" y="893.0938"/><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="314,104.25,495,104.25,505,124.25,495,144.25,314,144.25,304,124.25,314,104.25" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="316" y="121.7451">Activity的根View。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="316" y="138.0967">包含：TitleView、ContentView</text><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="572,154.9531,667,154.9531,677,166.9531,667,178.9531,572,178.9531,562,166.9531,572,154.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="574" y="172.4482">管理所有的窗口</text><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="435,189.3047,558,189.3047,568,209.3047,558,229.3047,435,229.3047,425,209.3047,435,189.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="437" y="206.7998">实现View树的绘制，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="437" y="223.1514">有三个关键方法。</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="56" x2="103" y1="252.3594" y2="252.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="103" y1="252.3594" y2="265.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="103" y1="265.3594" y2="265.3594"/><polygon fill="#A80036" points="72,261.3594,62,265.3594,72,269.3594,68,265.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="68" y="247.5029">handleLaunchActivity()</text><polygon fill="#A80036" points="193,296.7109,203,300.7109,193,304.7109,197,300.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="199" y1="300.7109" y2="300.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="68" y="295.8545">xxx -&gt; attach()</text><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="148,313.7109,261,313.7109,271,341.7109,261,370.7109,148,370.7109,138,341.7109,148,313.7109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="150" y="331.2061">第一步：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="150" y="347.5576">创建PhoneWindow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="150" y="363.9092">和WindowManager</text><polygon fill="#A80036" points="188,394.1172,198,398.1172,188,402.1172,192,398.1172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="194" y1="398.1172" y2="398.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="68" y="393.2607">xxx -&gt; onCreate()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="210" x2="257" y1="423.4688" y2="423.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="257" x2="257" y1="423.4688" y2="436.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="216" x2="257" y1="436.4688" y2="436.4688"/><polygon fill="#A80036" points="226,432.4688,216,436.4688,226,440.4688,222,436.4688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="222" y="418.6123">setContentView()</text><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="160,454.4688,250,454.4688,260,474.4688,250,494.4688,160,494.4688,150,474.4688,160,454.4688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="162" y="471.9639">第二步：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="162" y="488.3154">创建decorView</text><polygon fill="#008000" points="393,539.875,403,543.875,393,547.875,397,543.875" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="205" x2="399" y1="543.875" y2="543.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="212" y="539.0186">PhoneWindow#installDecor()</text><path d="M410,505.1719 L410,564.1719 L559,564.1719 L559,515.1719 L549,505.1719 L410,505.1719 " fill="#FBFB77" filter="url(#fjk03hm3z102f)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M549,505.1719 L549,515.1719 L559,515.1719 L549,505.1719 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="416" y="523.667">installDecor()只是建立</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="416" y="540.0186">view tree的数据结构，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="416" y="556.3701">还没开始显示</text><polygon fill="#A80036" points="193,591.5781,203,595.5781,193,599.5781,197,595.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="199" y1="595.5781" y2="595.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="68" y="590.7217">xxx -&gt; onStart()</text><polygon fill="#A80036" points="193,621.9297,203,625.9297,193,629.9297,197,625.9297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="199" y1="625.9297" y2="625.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="68" y="621.0732">xxx -&gt; onResume()</text><polygon fill="#A80036" points="188,652.2813,198,656.2813,188,660.2813,192,656.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="194" y1="656.2813" y2="656.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="68" y="651.4248">xxx -&gt; makeVisible()</text><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="146,669.2813,263,669.2813,273,689.2813,263,709.2813,146,709.2813,136,689.2813,146,669.2813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="148" y="686.7764">第三步：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="148" y="703.1279">decorView加入wms</text><polygon fill="#008000" points="607.5,746.5117,617.5,750.5117,607.5,754.5117,611.5,750.5117" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="205" x2="613.5" y1="750.5117" y2="750.5117"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="212" y="745.6553">wm.addView(decor, l);</text><path d="M624,719.9844 L624,761.9844 L778,761.9844 L778,729.9844 L768,719.9844 L624,719.9844 " fill="#FBFB77" filter="url(#fjk03hm3z102f)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M768,719.9844 L768,729.9844 L778,729.9844 L768,719.9844 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="630" y="738.4795">1. 创建ViewRootImpl</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="630" y="754.8311">2. 和wms建立双向通信</text><path d="M432,776.6875 L432,802.6875 L557,802.6875 L557,786.6875 L547,776.6875 L432,776.6875 " fill="#008000" filter="url(#fjk03hm3z102f)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M547,776.6875 L547,786.6875 L557,786.6875 L547,776.6875 " fill="#008000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="438" y="795.1826">屏幕刷新信号来了</text><polygon fill="#CCFFE5" filter="url(#fjk03hm3z102f)" points="446,817.0391,546,817.0391,556,837.0391,546,857.0391,446,857.0391,436,837.0391,446,817.0391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="448" y="834.5342">第四步：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="448" y="850.8857">申请Surface绘制</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="501.5" x2="543.5" y1="885.0938" y2="885.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="543.5" x2="543.5" y1="885.0938" y2="898.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="502.5" x2="543.5" y1="898.0938" y2="898.0938"/><polygon fill="#A80036" points="512.5,894.0938,502.5,898.0938,512.5,902.0938,508.5,898.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="508.5" y="880.2373">performTraversals()</text><!--MD5=[817af9cf8c5a6713ad2dc164c3a70d0d]
@startuml


title __DecorView的显示流程_时序图__


entity ActivityThread
entity Activity

entity DecorView

entity ViewRootImpl

entity WindowManagerImpl as WindowManager

hnote over DecorView#ccffe5: Activity的根View。\n包含：TitleView、ContentView
hnote over WindowManager#ccffe5: 管理所有的窗口
hnote over ViewRootImpl#ccffe5: 实现View树的绘制，\n有三个关键方法。


ActivityThread -> ActivityThread: handleLaunchActivity()
activate ActivityThread

ActivityThread -> Activity: xxx -> attach()
hnote over Activity#ccffe5 : 第一步：\n创建PhoneWindow\n和WindowManager


ActivityThread -> Activity: xxx -> onCreate()
activate Activity
    Activity -> Activity: setContentView()
    activate Activity
        hnote over Activity#ccffe5 : 第二步：\n创建decorView
        Activity [#green]-> DecorView: PhoneWindow#installDecor()
        note right : installDecor()只是建立\nview tree的数据结构，\n还没开始显示
    deactivate Activity
deactivate Activity

ActivityThread -> Activity: xxx -> onStart()

ActivityThread -> Activity: xxx -> onResume()

ActivityThread -> Activity: xxx -> makeVisible()
activate Activity
    hnote over Activity#ccffe5 : 第三步：\ndecorView加入wms
    Activity [#green]-> WindowManager: wm.addView(decor, l);
    note right : 1. 创建ViewRootImpl\n2. 和wms建立双向通信
deactivate Activity


note over ViewRootImpl #green:屏幕刷新信号来了

hnote over ViewRootImpl#ccffe5 : 第四步：\n申请Surface绘制

ViewRootImpl -> ViewRootImpl: performTraversals()
activate ViewRootImpl
deactivate ViewRootImpl
@enduml

PlantUML version 1.2020.06(Sun Apr 05 20:38:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Windows 10
Default Encoding: UTF8
Language: zh
Country: CN
--></g></svg>