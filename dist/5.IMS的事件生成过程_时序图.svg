<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="984px" preserveAspectRatio="none" style="width:1202px;height:984px;" version="1.1" viewBox="0 0 1202 984" width="1202px" zoomAndPan="magnify"><defs><filter height="300%" id="fgodfzu65pqee" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="157" x="523.5" y="28.6855">IMS的事件生成过程</text><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="51.5" y="232.2656"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="228.5" y="330.9688"/><rect fill="#CCFFE5" filter="url(#fgodfzu65pqee)" height="152.7578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="309.5" y="396.6719"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="292.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="396.5" y="514.0781"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401.5" y="636.8359"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="49.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401.5" y="710.1875"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="629.5" y="745.5391"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="122.4063" style="stroke: #000000; stroke-width: 2.0;" width="336" x="13" y="282.2656"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="348.8672" style="stroke: #000000; stroke-width: 2.0;" width="406.5" x="280" y="465.375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="56" x2="56" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="233.5" x2="233.5" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="314" x2="314" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="401" x2="401" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="634.5" x2="634.5" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="802.5" x2="802.5" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="982.5" x2="982.5" y1="106.8594" y2="908.2969"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1159" x2="1159" y1="106.8594" y2="908.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="23" y="103.7832">EventHub</text><ellipse cx="56.5" cy="73.25" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="44.5" x2="68.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="23" y="921.8301">EventHub</text><ellipse cx="56.5" cy="940.9063" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="44.5" x2="68.5" y1="954.9063" y2="954.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="191.5" y="103.7832">InputReader</text><ellipse cx="233.5" cy="73.25" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="221.5" x2="245.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="191.5" y="921.8301">InputReader</text><ellipse cx="233.5" cy="940.9063" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="221.5" x2="245.5" y1="954.9063" y2="954.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="290" y="103.7832">Queue</text><path d="M296.5,53.25 C296.5,43.25 314.5,43.25 314.5,43.25 C314.5,43.25 332.5,43.25 332.5,53.25 L332.5,79.25 C332.5,89.25 314.5,89.25 314.5,89.25 C314.5,89.25 296.5,89.25 296.5,79.25 L296.5,53.25 " fill="#FEFECE" filter="url(#fgodfzu65pqee)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M296.5,53.25 C296.5,63.25 314.5,63.25 314.5,63.25 C314.5,63.25 332.5,63.25 332.5,53.25 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="290" y="921.8301">Queue</text><path d="M296.5,934.9063 C296.5,924.9063 314.5,924.9063 314.5,924.9063 C314.5,924.9063 332.5,924.9063 332.5,934.9063 L332.5,960.9063 C332.5,970.9063 314.5,970.9063 314.5,970.9063 C314.5,970.9063 296.5,970.9063 296.5,960.9063 L296.5,934.9063 " fill="#FEFECE" filter="url(#fgodfzu65pqee)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M296.5,934.9063 C296.5,944.9063 314.5,944.9063 314.5,944.9063 C314.5,944.9063 332.5,944.9063 332.5,934.9063 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="349" y="103.7832">InputDispatcher</text><ellipse cx="401.5" cy="73.25" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="389.5" x2="413.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="349" y="921.8301">InputDispatcher</text><ellipse cx="401.5" cy="940.9063" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="389.5" x2="413.5" y1="954.9063" y2="954.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="592.5" y="103.7832">InputMonitor</text><ellipse cx="634.5" cy="73.25" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="622.5" x2="646.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="592.5" y="921.8301">InputMonitor</text><ellipse cx="634.5" cy="940.9063" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="622.5" x2="646.5" y1="954.9063" y2="954.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="723.5" y="103.7832">WindowManagerService</text><ellipse cx="802.5" cy="73.25" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="790.5" x2="814.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="723.5" y="921.8301">WindowManagerService</text><ellipse cx="802.5" cy="940.9063" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="790.5" x2="814.5" y1="954.9063" y2="954.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="923.5" y="86.1738">ViewRootImpl中的</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="172" x="895.5" y="103.7832">WindowInputEventReceiver</text><ellipse cx="982.5" cy="55.6406" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="970.5" x2="994.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="923.5" y="921.8301">ViewRootImpl中的</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="172" x="895.5" y="939.4395">WindowInputEventReceiver</text><ellipse cx="982.5" cy="958.5156" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="970.5" x2="994.5" y1="972.5156" y2="972.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="1123" y="103.7832">DecorView</text><ellipse cx="1159.5" cy="73.25" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1147.5" x2="1171.5" y1="87.25" y2="87.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="1123" y="921.8301">DecorView</text><ellipse cx="1159.5" cy="940.9063" fill="#FEFECE" filter="url(#fgodfzu65pqee)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1147.5" x2="1171.5" y1="954.9063" y2="954.9063"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="51.5" y="232.2656"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="228.5" y="330.9688"/><rect fill="#CCFFE5" filter="url(#fgodfzu65pqee)" height="152.7578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="309.5" y="396.6719"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="292.1641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="396.5" y="514.0781"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401.5" y="636.8359"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="49.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="401.5" y="710.1875"/><rect fill="#FFFFFF" filter="url(#fgodfzu65pqee)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="629.5" y="745.5391"/><polygon fill="#CCFFE5" filter="url(#fgodfzu65pqee)" points="273,121.8594,355,121.8594,365,133.8594,355,145.8594,273,145.8594,263,133.8594,273,121.8594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="275" y="139.3545">事件缓存队列</text><polygon fill="#CCFFE5" filter="url(#fgodfzu65pqee)" points="747,156.2109,858,156.2109,868,176.2109,858,196.2109,747,196.2109,737,176.2109,747,156.2109" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="749" y="173.7061">下一步：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="749" y="190.0576">事件分发到Activity</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="61.5" x2="103.5" y1="224.2656" y2="224.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103.5" x2="103.5" y1="224.2656" y2="237.2656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="103.5" y1="237.2656" y2="237.2656"/><polygon fill="#A80036" points="72.5,233.2656,62.5,237.2656,72.5,241.2656,68.5,237.2656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="68.5" y="219.4092">读取/dev/input/下的设备文件</text><path d="M13,282.2656 L181,282.2656 L181,290.2656 L171,300.2656 L13,300.2656 L13,282.2656 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="122.4063" style="stroke: #000000; stroke-width: 2.0;" width="336" x="13" y="282.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="123" x="28" y="296.7607">InputReaderThread</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="233.5" x2="280.5" y1="317.9688" y2="317.9688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="280.5" y1="317.9688" y2="330.9688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239.5" x2="280.5" y1="330.9688" y2="330.9688"/><polygon fill="#A80036" points="249.5,326.9688,239.5,330.9688,249.5,334.9688,245.5,330.9688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="245.5" y="313.1123">loopOnce()</text><polygon fill="#A80036" points="67.5,362.3203,57.5,366.3203,67.5,370.3203,63.5,366.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61.5" x2="227.5" y1="366.3203" y2="366.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="73.5" y="361.4639">getEvents()</text><polygon fill="#A80036" points="297.5,392.6719,307.5,396.6719,297.5,400.6719,301.5,396.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="233.5" x2="303.5" y1="396.6719" y2="396.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="240.5" y="391.8154">事件入队</text><polygon fill="#A80036" points="645.5,446.375,635.5,450.375,645.5,454.375,641.5,450.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="639.5" x2="801.5" y1="450.375" y2="450.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="651.5" y="429.167">updateInputWindowsLw()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="651.5" y="445.5186">更新焦点窗口</text><path d="M280,465.375 L469,465.375 L469,473.375 L459,483.375 L280,483.375 L280,465.375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="348.8672" style="stroke: #000000; stroke-width: 2.0;" width="406.5" x="280" y="465.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="295" y="479.8701">InputDispatcherThread</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="401.5" x2="448.5" y1="501.0781" y2="501.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="448.5" y1="501.0781" y2="514.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="407.5" x2="448.5" y1="514.0781" y2="514.0781"/><polygon fill="#A80036" points="417.5,510.0781,407.5,514.0781,417.5,518.0781,413.5,514.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="413.5" y="496.2217">dispatchOnce()</text><polygon fill="#A80036" points="325.5,545.4297,315.5,549.4297,325.5,553.4297,321.5,549.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="319.5" x2="395.5" y1="549.4297" y2="549.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="331.5" y="544.5732">读取事件</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="453.5" y1="628.8359" y2="628.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="453.5" x2="453.5" y1="628.8359" y2="641.8359"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="412.5" x2="453.5" y1="641.8359" y2="641.8359"/><polygon fill="#A80036" points="422.5,637.8359,412.5,641.8359,422.5,645.8359,418.5,641.8359" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="418.5" y="574.9248">事件预处理</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="418.5" y="591.2764">1.repeatCount</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="418.5" y="607.6279">2.交给wms处理</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="418.5" y="623.9795">3.忽略</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="406.5" x2="453.5" y1="697.1875" y2="697.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="453.5" x2="453.5" y1="697.1875" y2="710.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="412.5" x2="453.5" y1="710.1875" y2="710.1875"/><polygon fill="#A80036" points="422.5,706.1875,412.5,710.1875,422.5,714.1875,418.5,710.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="418.5" y="692.3311">findFocusedWindowTargetsLocked()</text><polygon fill="#A80036" points="617.5,741.5391,627.5,745.5391,617.5,749.5391,621.5,745.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="411.5" x2="623.5" y1="745.5391" y2="745.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="418.5" y="740.6826">查询当前焦点窗口</text><polygon fill="#A80036" points="417.5,755.5391,407.5,759.5391,417.5,763.5391,413.5,759.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="411.5" x2="633.5" y1="759.5391" y2="759.5391"/><polygon fill="#A80036" points="622.5,802.2422,632.5,806.2422,622.5,810.2422,626.5,806.2422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="401.5" x2="628.5" y1="806.2422" y2="806.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="408.5" y="785.0342">dispatchEventLocked()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="408.5" y="801.3857">分发事件给当前焦点窗口</text><polygon fill="#A80036" points="970.5,839.5938,980.5,843.5938,970.5,847.5938,974.5,843.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="634.5" x2="976.5" y1="843.5938" y2="843.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="641.5" y="838.7373">通过InputChannel的socket通知</text><polygon fill="#A80036" points="1147.5,886.2969,1157.5,890.2969,1147.5,894.2969,1151.5,890.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="982.5" x2="1153.5" y1="890.2969" y2="890.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="989.5" y="869.0889">经过各层责任链InputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="989.5" y="885.4404">最终到DecoerView</text><!--MD5=[ac1d6e2e8d2c8543818415565803916c]
@startuml



title __IMS的事件生成过程__


entity EventHub
entity InputReader
database Queue
entity InputDispatcher

entity InputMonitor
entity WindowManagerService as wms
entity "ViewRootImpl中的\n WindowInputEventReceiver" as InputEventReceiver
entity DecorView

hnote over Queue#ccffe5:事件缓存队列
hnote over wms#ccffe5:下一步：\n事件分发到Activity

EventHub -> EventHub: 读取/dev/input/下的设备文件
activate EventHub
deactivate EventHub

group InputReaderThread
    InputReader -> InputReader: loopOnce()
    activate InputReader
        InputReader -> EventHub: getEvents()
        InputReader -> Queue: 事件入队
    deactivate InputReader

    activate Queue#ccffe5
end


wms -> InputMonitor: updateInputWindowsLw()\n更新焦点窗口
group InputDispatcherThread

    InputDispatcher ->InputDispatcher: dispatchOnce()
    activate InputDispatcher
        InputDispatcher -> Queue: 读取事件
        deactivate Queue

        InputDispatcher -> InputDispatcher :事件预处理\n1.repeatCount\n2.交给wms处理\n3.忽略
        activate InputDispatcher
        deactivate InputDispatcher

        InputDispatcher -> InputDispatcher: findFocusedWindowTargetsLocked()
        activate InputDispatcher
                InputDispatcher -> InputMonitor: 查询当前焦点窗口
                activate InputMonitor
                    InputMonitor - -> InputDispatcher
                deactivate InputMonitor
        deactivate InputDispatcher



        InputDispatcher -> InputMonitor: dispatchEventLocked()\n分发事件给当前焦点窗口
    deactivate InputDispatcher
end

InputMonitor -> InputEventReceiver:通过InputChannel的socket通知
InputEventReceiver -> DecorView:经过各层责任链InputStage\n最终到DecoerView
@enduml

PlantUML version 1.2020.06(Sun Apr 05 20:38:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Windows 10
Default Encoding: UTF8
Language: zh
Country: CN
--></g></svg>