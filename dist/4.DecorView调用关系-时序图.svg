<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1892px" preserveAspectRatio="none" style="width:1929px;height:1892px;" version="1.1" viewBox="0 0 1929 1892" width="1929px" zoomAndPan="magnify"><defs><filter height="300%" id="f16aguwp839q2x" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="200" x="864" y="28.6855">DecorView绑定-调用关系</text><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="1228.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="51" y="399.4688"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="873.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="56" y="753.6875"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="61" y="797.0391"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="93.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="365" y="434.8203"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="143.582" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="365" y="558.5781"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="734.4375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="365" y="893.0938"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="100.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="585" y="602.1055"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="590" y="653.6328"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="40.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="875.5" y="933.6211"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="613.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1029.5" y="974.1484"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="186.1094" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1323.5" y="1020.8516"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="344.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1323.5" y="1242.3125"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="78.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1328.5" y="1280.6641"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333.5" y="1324.0156"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="91.8789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1323.5" y="1711.2344"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1328.5" y="1754.5859"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="56" x2="56" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="370" x2="370" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="590" x2="590" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="765.5" x2="765.5" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="880.5" x2="880.5" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1034.5" x2="1034.5" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1328.5" x2="1328.5" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1686" x2="1686" y1="89.25" y2="1834.2891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1802" x2="1802" y1="89.25" y2="1834.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="8" y="86.1738">ActivityThread</text><ellipse cx="56" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="44" x2="68" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="8" y="1847.8223">ActivityThread</text><ellipse cx="56" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="44" x2="68" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="345" y="86.1738">Activity</text><ellipse cx="370" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="358" x2="382" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="345" y="1847.8223">Activity</text><ellipse cx="370" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="358" x2="382" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="542" y="86.1738">PhoneWindow</text><ellipse cx="590" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="578" x2="602" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="542" y="1847.8223">PhoneWindow</text><ellipse cx="590" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="578" x2="602" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="729.5" y="86.1738">DecorView</text><ellipse cx="766" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="754" x2="778" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="729.5" y="1847.8223">DecorView</text><ellipse cx="766" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="754" x2="778" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="812.5" y="86.1738">WindowManagerImpl</text><ellipse cx="880.5" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="868.5" x2="892.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="130" x="812.5" y="1847.8223">WindowManagerImpl</text><ellipse cx="880.5" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="868.5" x2="892.5" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="958.5" y="86.1738">WindowManagerGlobal</text><ellipse cx="1034.5" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1022.5" x2="1046.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="958.5" y="1847.8223">WindowManagerGlobal</text><ellipse cx="1034.5" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1022.5" x2="1046.5" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="1283.5" y="86.1738">ViewRootImpl</text><ellipse cx="1328.5" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1316.5" x2="1340.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="1283.5" y="1847.8223">ViewRootImpl</text><ellipse cx="1328.5" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1316.5" x2="1340.5" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1635" y="86.1738">Choreographer</text><ellipse cx="1686.5" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1674.5" x2="1698.5" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1635" y="1847.8223">Choreographer</text><ellipse cx="1686.5" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1674.5" x2="1698.5" y1="1880.8984" y2="1880.8984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="1748" y="86.1738">IWindowSession</text><ellipse cx="1802" cy="55.6406" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1790" x2="1814" y1="69.6406" y2="69.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="102" x="1748" y="1847.8223">IWindowSession</text><ellipse cx="1802" cy="1866.8984" fill="#FEFECE" filter="url(#f16aguwp839q2x)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1790" x2="1814" y1="1880.8984" y2="1880.8984"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="1228.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="51" y="399.4688"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="873.8438" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="56" y="753.6875"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="65.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="61" y="797.0391"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="93.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="365" y="434.8203"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="143.582" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="365" y="558.5781"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="734.4375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="365" y="893.0938"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="100.0547" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="585" y="602.1055"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="590" y="653.6328"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="40.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="875.5" y="933.6211"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="613.0313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1029.5" y="974.1484"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="186.1094" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1323.5" y="1020.8516"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="344.8672" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1323.5" y="1242.3125"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="78.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1328.5" y="1280.6641"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="35.3516" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1333.5" y="1324.0156"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="91.8789" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1323.5" y="1711.2344"/><rect fill="#FFFFFF" filter="url(#f16aguwp839q2x)" height="48.5273" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1328.5" y="1754.5859"/><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="493,104.25,687,104.25,697,132.25,687,161.25,493,161.25,483,132.25,493,104.25" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="495" y="121.7451">Window 的实现类，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="495" y="138.0967">包含一个 DecorView</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="495" y="154.4482">功能：给view包裹一层DecorView</text><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="675,171.3047,856,171.3047,866,191.3047,856,211.3047,675,211.3047,665,191.3047,675,171.3047" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="677" y="188.7998">Activity的根View。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="677" y="205.1514">包含：TitleView、ContentView</text><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="833,222.0078,928,222.0078,938,234.0078,928,246.0078,833,246.0078,823,234.0078,833,222.0078" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="835" y="239.5029">管理所有的窗口</text><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="1267,256.3594,1390,256.3594,1400,276.3594,1390,296.3594,1267,296.3594,1257,276.3594,1267,256.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1269" y="273.8545">实现View树的绘制，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1269" y="290.2061">有三个关键方法。</text><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="1694,307.0625,1910,307.0625,1920,335.0625,1910,364.0625,1694,364.0625,1684,335.0625,1694,307.0625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1696" y="324.5576">WMS中Session的Binder代理对象 。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1696" y="340.9092">每个应用进程只有唯一的 Session</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1700" y="357.2607">对象与 WMS 通信。</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="56" x2="103" y1="386.4688" y2="386.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="103" x2="103" y1="386.4688" y2="399.4688"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62" x2="103" y1="399.4688" y2="399.4688"/><polygon fill="#A80036" points="72,395.4688,62,399.4688,72,403.4688,68,399.4688" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="68" y="381.6123">handleLaunchActivity()</text><polygon fill="#A80036" points="353,430.8203,363,434.8203,353,438.8203,357,434.8203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="359" y1="434.8203" y2="434.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="68" y="429.9639">xxx -&gt; attach()</text><polygon fill="#A80036" points="578,477.5234,588,481.5234,578,485.5234,582,481.5234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375" x2="584" y1="481.5234" y2="481.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="382" y="460.3154">mWindow =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="382" y="476.667">new PhoneWindow();</text><polygon fill="#A80036" points="578,524.2266,588,528.2266,578,532.2266,582,528.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="370" x2="584" y1="528.2266" y2="528.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="377" y="507.0186">mWindowManager =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="381" y="523.3701">mWindow.getWindowManager();</text><polygon fill="#A80036" points="353,554.5781,363,558.5781,353,562.5781,357,558.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="359" y1="558.5781" y2="558.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="68" y="553.7217">xxx -&gt; onCreate()</text><polygon fill="#A80036" points="573,598.1055,583,602.1055,573,606.1055,577,602.1055" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="375" x2="579" y1="602.1055" y2="602.1055"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="382" y="597.249">setContentView()</text><path d="M181,571.5781 L181,613.5781 L356,613.5781 L356,581.5781 L346,571.5781 L181,571.5781 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M346,571.5781 L346,581.5781 L356,581.5781 L346,571.5781 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="187" y="590.0732">建立view tree的数据结构，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="187" y="606.4248">还没有真正显示</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="595" x2="642" y1="640.6328" y2="640.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="642" x2="642" y1="640.6328" y2="653.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="601" x2="642" y1="653.6328" y2="653.6328"/><polygon fill="#A80036" points="611,649.6328,601,653.6328,611,657.6328,607,653.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="607" y="635.7764">installDecor()</text><polygon fill="#A80036" points="754,698.1602,764,702.1602,754,706.1602,758,702.1602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="590" x2="760" y1="702.1602" y2="702.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="597" y="697.3037">mDecor.setWindow(this)</text><path d="M771,671.6328 L771,713.6328 L909,713.6328 L909,681.6328 L899,671.6328 L771,671.6328 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M899,671.6328 L899,681.6328 L909,681.6328 L899,671.6328 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="777" y="690.1279">DecorView和window</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="777" y="706.4795">相互持有</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="61" x2="108" y1="740.6875" y2="740.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108" x2="108" y1="740.6875" y2="753.6875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67" x2="108" y1="753.6875" y2="753.6875"/><polygon fill="#A80036" points="77,749.6875,67,753.6875,77,757.6875,73,753.6875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="73" y="735.8311">xxx -&gt; handleResumeActivity()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="66" x2="113" y1="784.0391" y2="784.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="113" x2="113" y1="784.0391" y2="797.0391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="72" x2="113" y1="797.0391" y2="797.0391"/><polygon fill="#A80036" points="82,793.0391,72,797.0391,82,801.0391,78,797.0391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="78" y="779.1826">ActivityRecordClient r =  performResumeActivity()</text><polygon fill="#A80036" points="358,828.3906,368,832.3906,358,836.3906,362,832.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71" x2="364" y1="832.3906" y2="832.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="78" y="827.5342">xxx -&gt; onStart()</text><polygon fill="#A80036" points="358,858.7422,368,862.7422,358,866.7422,362,862.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="66" x2="364" y1="862.7422" y2="862.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="73" y="857.8857">xxx -&gt; onResume()</text><polygon fill="#A80036" points="353,889.0938,363,893.0938,353,897.0938,357,893.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="66" x2="359" y1="893.0938" y2="893.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="73" y="888.2373">xxx -&gt; makeVisible()</text><polygon fill="#008000" points="863.5,929.6211,873.5,933.6211,863.5,937.6211,867.5,933.6211" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="375" x2="869.5" y1="933.6211" y2="933.6211"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="382" y="928.7646">wm.addView(decor, l);</text><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="256,906.0938,350,906.0938,360,926.0938,350,946.0938,256,946.0938,246,926.0938,256,906.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="258" y="923.5889">关键步骤：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="258" y="939.9404">把view加入wms</text><polygon fill="#A80036" points="1017.5,970.1484,1027.5,974.1484,1017.5,978.1484,1021.5,974.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="880.5" x2="1023.5" y1="974.1484" y2="974.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="887.5" y="969.292">addView();</text><polygon fill="#A80036" points="1311.5,1016.8516,1321.5,1020.8516,1311.5,1024.8516,1315.5,1020.8516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1039.5" x2="1317.5" y1="1020.8516" y2="1020.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="1046.5" y="999.6436">root =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="1046.5" y="1015.9951">new ViewRootImpl()</text><polygon fill="#CCFFE5" filter="url(#f16aguwp839q2x)" points="1287,1033.8516,1369,1033.8516,1379,1045.8516,1369,1057.8516,1287,1057.8516,1277,1045.8516,1287,1033.8516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="1289" y="1051.3467">当前是主线程</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1375.5" y1="1085.5547" y2="1085.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1375.5" x2="1375.5" y1="1085.5547" y2="1098.5547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1334.5" x2="1375.5" y1="1098.5547" y2="1098.5547"/><polygon fill="#A80036" points="1344.5,1094.5547,1334.5,1098.5547,1344.5,1102.5547,1340.5,1098.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1340.5" y="1080.6982">mThread = Thread.currentThread();</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1375.5" y1="1135.582" y2="1135.582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1375.5" x2="1375.5" y1="1135.582" y2="1148.582"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1334.5" x2="1375.5" y1="1148.582" y2="1148.582"/><polygon fill="#A80036" points="1344.5,1144.582,1334.5,1148.582,1344.5,1152.582,1340.5,1148.582" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1340.5" y="1130.7256">mWindow = new W(this);</text><path d="M1148,1111.5547 L1148,1153.5547 L1314,1153.5547 L1314,1121.5547 L1304,1111.5547 L1148,1111.5547 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1304,1111.5547 L1304,1121.5547 L1314,1121.5547 L1304,1111.5547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1154" y="1130.0498">数据类型为IWindow.Stub</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1154" y="1146.4014">在wms中代表应用端</text><polygon fill="#A80036" points="1050.5,1202.9609,1040.5,1206.9609,1050.5,1210.9609,1046.5,1206.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1044.5" x2="1327.5" y1="1206.9609" y2="1206.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="1056.5" y="1185.7529">mWindowSession =</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="1056.5" y="1202.1045">WindowManagerGlobal.getWindowSession();</text><path d="M1338,1168.2578 L1338,1210.2578 L1588,1210.2578 L1588,1178.2578 L1578,1168.2578 L1338,1168.2578 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1578,1168.2578 L1578,1178.2578 L1588,1178.2578 L1578,1168.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="1344" y="1186.7529">数据类型为IWindowSession,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="1344" y="1203.1045">同一进程只对应唯一Session代理对象。</text><polygon fill="#A80036" points="1311.5,1238.3125,1321.5,1242.3125,1311.5,1246.3125,1315.5,1242.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1039.5" x2="1317.5" y1="1242.3125" y2="1242.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="1046.5" y="1237.4561">root.setView(View view)//比如DecorView</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1380.5" y1="1267.6641" y2="1267.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1380.5" x2="1380.5" y1="1267.6641" y2="1280.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1339.5" x2="1380.5" y1="1280.6641" y2="1280.6641"/><polygon fill="#A80036" points="1349.5,1276.6641,1339.5,1280.6641,1349.5,1284.6641,1345.5,1280.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="1345.5" y="1262.8076">requestLayout()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1338.5" x2="1385.5" y1="1311.0156" y2="1311.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1385.5" x2="1385.5" y1="1311.0156" y2="1324.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1344.5" x2="1385.5" y1="1324.0156" y2="1324.0156"/><polygon fill="#A80036" points="1354.5,1320.0156,1344.5,1324.0156,1354.5,1328.0156,1350.5,1324.0156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1350.5" y="1306.1592">scheduleTraversals()</text><polygon fill="#A80036" points="1674.5,1355.3672,1684.5,1359.3672,1674.5,1363.3672,1678.5,1359.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1680.5" y1="1359.3672" y2="1359.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="319" x="1340.5" y="1354.5107">mChoreographer.postCallback(… ,mTraversalRunnable)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1375.5" y1="1389.7188" y2="1389.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1375.5" x2="1375.5" y1="1389.7188" y2="1402.7188"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1334.5" x2="1375.5" y1="1402.7188" y2="1402.7188"/><polygon fill="#A80036" points="1344.5,1398.7188,1334.5,1402.7188,1344.5,1406.7188,1340.5,1402.7188" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="1340.5" y="1384.8623">mInputChannel = new InputChannel();</text><polygon fill="#A80036" points="1790,1442.2461,1800,1446.2461,1790,1450.2461,1794,1446.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1796" y1="1446.2461" y2="1446.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="1340.5" y="1441.3896">mWindowSession.addToDisplay(mWindow, ...mInputChannel)</text><path d="M1127,1415.7188 L1127,1457.7188 L1314,1457.7188 L1314,1425.7188 L1304,1415.7188 L1127,1415.7188 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1304,1415.7188 L1304,1425.7188 L1314,1425.7188 L1304,1415.7188 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="1133" y="1434.2139">和wms可以双向通信了</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1133" y="1450.5654">同时完成InputChannel的注册</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1375.5" y1="1538.8281" y2="1538.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1375.5" x2="1375.5" y1="1538.8281" y2="1551.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1334.5" x2="1375.5" y1="1551.8281" y2="1551.8281"/><polygon fill="#A80036" points="1344.5,1547.8281,1334.5,1551.8281,1344.5,1555.8281,1340.5,1551.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1340.5" y="1484.917">SyntheticInputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="1344.5" y="1501.2686">ViewPostImeInputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1344.5" y="1517.6201">NativePostImeInputStage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="12" x="1344.5" y="1533.9717">...</text><path d="M1189,1498.4492 L1189,1524.4492 L1314,1524.4492 L1314,1508.4492 L1304,1498.4492 L1189,1498.4492 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1304,1498.4492 L1304,1508.4492 L1314,1508.4492 L1304,1498.4492 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1195" y="1516.9443">对责任链进行组装</text><polygon fill="#A80036" points="777,1583.1797,767,1587.1797,777,1591.1797,773,1587.1797" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="771" x2="1327.5" y1="1587.1797" y2="1587.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="783" y="1582.3232">assignParent(this)</text><path d="M509,1564.8281 L509,1590.8281 L757,1590.8281 L757,1574.8281 L747,1564.8281 L509,1564.8281 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M747,1564.8281 L747,1574.8281 L757,1574.8281 L747,1564.8281 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="515" y="1583.3232">终于终于，mDecor知道了自己父亲是谁</text><polygon fill="#A80036" points="754,1623.5313,764,1627.5313,754,1631.5313,758,1627.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="370" x2="760" y1="1627.5313" y2="1627.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="377" y="1622.6748">mDecor.setVisibility(View.VISIBLE)</text><path d="M771,1605.1797 L771,1631.1797 L894,1631.1797 L894,1615.1797 L884,1605.1797 L771,1605.1797 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M884,1605.1797 L884,1615.1797 L894,1615.1797 L884,1605.1797 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="777" y="1623.6748">view还没开始绘制</text><path d="M1264,1645.5313 L1264,1671.5313 L1389,1671.5313 L1389,1655.5313 L1379,1645.5313 L1264,1645.5313 " fill="#008000" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1379,1645.5313 L1379,1655.5313 L1389,1655.5313 L1379,1645.5313 " fill="#008000" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="1270" y="1664.0264">屏幕刷新信号来了</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1328.5" x2="1375.5" y1="1698.2344" y2="1698.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1375.5" x2="1375.5" y1="1698.2344" y2="1711.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1334.5" x2="1375.5" y1="1711.2344" y2="1711.2344"/><polygon fill="#A80036" points="1344.5,1707.2344,1334.5,1711.2344,1344.5,1715.2344,1340.5,1711.2344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1340.5" y="1693.3779">performTraversals()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1333.5" x2="1380.5" y1="1741.5859" y2="1741.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1380.5" x2="1380.5" y1="1741.5859" y2="1754.5859"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1339.5" x2="1380.5" y1="1754.5859" y2="1754.5859"/><polygon fill="#A80036" points="1349.5,1750.5859,1339.5,1754.5859,1349.5,1758.5859,1345.5,1754.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="1345.5" y="1736.7295">relayoutWindow()</text><polygon fill="#A80036" points="1790,1799.1133,1800,1803.1133,1790,1807.1133,1794,1803.1133" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1328.5" x2="1796" y1="1803.1133" y2="1803.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="1335.5" y="1798.2568">mWindowSession.relayout(..., mSurface)</text><path d="M1010,1772.5859 L1010,1814.5859 L1314,1814.5859 L1314,1782.5859 L1304,1772.5859 L1010,1772.5859 " fill="#FBFB77" filter="url(#f16aguwp839q2x)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1304,1772.5859 L1304,1782.5859 L1314,1782.5859 L1304,1772.5859 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1016" y="1791.0811">申请Surface，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1016" y="1807.4326">有了Surface才可以把绘制的内容写入其中的buffer</text><!--MD5=[74a3a1ddf01b0a050c59f3a7dc056694]
@startuml


title __DecorView绑定-调用关系__


entity ActivityThread
entity Activity
entity PhoneWindow

entity DecorView
entity WindowManagerImpl as WindowManager
entity WindowManagerGlobal

entity ViewRootImpl

entity Choreographer
entity IWindowSession

hnote over PhoneWindow#ccffe5: Window 的实现类，\n包含一个 DecorView\n功能：给view包裹一层DecorView
hnote over DecorView#ccffe5: Activity的根View。\n包含：TitleView、ContentView
hnote over WindowManager#ccffe5: 管理所有的窗口
hnote over ViewRootImpl#ccffe5: 实现View树的绘制，\n有三个关键方法。
hnote over IWindowSession#ccffe5: WMS中Session的Binder代理对象 。\n每个应用进程只有唯一的 Session\n 对象与 WMS 通信。


ActivityThread -> ActivityThread: handleLaunchActivity()
activate ActivityThread

    ActivityThread -> Activity: xxx -> attach()
    activate Activity
        Activity -> PhoneWindow: mWindow =\nnew PhoneWindow();
        Activity -> PhoneWindow: mWindowManager =\n mWindow.getWindowManager();
    deactivate Activity

    ActivityThread -> Activity: xxx -> onCreate()
    activate Activity
        Activity -> PhoneWindow: setContentView()
        note left : 建立view tree的数据结构，\n还没有真正显示
        activate PhoneWindow
            PhoneWindow -> PhoneWindow: installDecor()
            activate PhoneWindow
                PhoneWindow -> DecorView: mDecor.setWindow(this)
            deactivate PhoneWindow
            note right : DecorView和window\n相互持有
        deactivate PhoneWindow
    deactivate Activity

    ActivityThread -> ActivityThread: xxx -> handleResumeActivity()
    activate ActivityThread
        ActivityThread -> ActivityThread: ActivityRecordClient r =  performResumeActivity()
        activate ActivityThread
            ActivityThread -> Activity: xxx -> onStart()
            ActivityThread -> Activity: xxx -> onResume()
        deactivate ActivityThread

        ActivityThread -> Activity: xxx -> makeVisible()
        activate Activity
            Activity [#green]-> WindowManager: wm.addView(decor, l);
            hnote left#ccffe5 : 关键步骤：\n把view加入wms
            activate WindowManager
                WindowManager -> WindowManagerGlobal: addView();
            deactivate WindowManager
            activate WindowManagerGlobal
                WindowManagerGlobal -> ViewRootImpl: root = \nnew ViewRootImpl()
                activate ViewRootImpl
                    hnote over ViewRootImpl#ccffe5: 当前是主线程
                    ViewRootImpl -> ViewRootImpl: mThread = Thread.currentThread();
                    ViewRootImpl -> ViewRootImpl: mWindow = new W(this);
                    note left : 数据类型为IWindow.Stub\n在wms中代表应用端
                    ViewRootImpl -> WindowManagerGlobal: mWindowSession = \nWindowManagerGlobal.getWindowSession();
                    note right : 数据类型为IWindowSession, \n同一进程只对应唯一Session代理对象。
                deactivate ViewRootImpl
                WindowManagerGlobal -> ViewRootImpl: root.setView(View view)//比如DecorView
                activate ViewRootImpl
                    ViewRootImpl -> ViewRootImpl: requestLayout()
                    activate ViewRootImpl
                        ViewRootImpl -> ViewRootImpl: scheduleTraversals()
                        activate ViewRootImpl
                            ViewRootImpl -> Choreographer: mChoreographer.postCallback(… ,mTraversalRunnable)
                        deactivate ViewRootImpl
                    deactivate ViewRootImpl

                    ViewRootImpl -> ViewRootImpl: mInputChannel = new InputChannel();
                    ViewRootImpl -> IWindowSession: mWindowSession.addToDisplay(mWindow, ...mInputChannel)
                    note left : 和wms可以双向通信了\n同时完成InputChannel的注册

                    ViewRootImpl -> ViewRootImpl: SyntheticInputStage\n ViewPostImeInputStage\n NativePostImeInputStage\n ...
                    note left : 对责任链进行组装
                    ViewRootImpl -> DecorView: assignParent(this)
                    note left : 终于终于，mDecor知道了自己父亲是谁
                deactivate ViewRootImpl
            deactivate WindowManagerGlobal
            Activity -> DecorView :  mDecor.setVisibility(View.VISIBLE)
            note right : view还没开始绘制
        deactivate Activity
    deactivate ActivityThread
deactivate ActivityThread


note over ViewRootImpl #green:屏幕刷新信号来了
ViewRootImpl -> ViewRootImpl: performTraversals()
activate ViewRootImpl
    ViewRootImpl -> ViewRootImpl: relayoutWindow()
    activate ViewRootImpl
        ViewRootImpl -> IWindowSession: mWindowSession.relayout(..., mSurface)
        note left : 申请Surface，\n有了Surface才可以把绘制的内容写入其中的buffer
    deactivate ViewRootImpl
deactivate ViewRootImpl
@enduml

PlantUML version 1.2020.06(Sun Apr 05 20:38:32 CST 2020)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Windows 10
Default Encoding: UTF8
Language: zh
Country: CN
--></g></svg>